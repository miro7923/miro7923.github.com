<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-05-28T22:40:35+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Yujin Dev Log</title><subtitle>개발 공부 기록하는 블로그</subtitle><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><entry><title type="html">JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 19 - 주문시 베송지 목록 새 창에서 선택된 배송지 정보 가져오는 기능 추가</title><link href="http://localhost:4000/uno%20mas/uno-mas-dev-log-19/" rel="alternate" type="text/html" title="JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 19 - 주문시 베송지 목록 새 창에서 선택된 배송지 정보 가져오는 기능 추가" /><published>2022-05-27T00:00:00+09:00</published><updated>2022-05-27T00:00:00+09:00</updated><id>http://localhost:4000/uno%20mas/uno-mas-dev-log-19</id><content type="html" xml:base="http://localhost:4000/uno%20mas/uno-mas-dev-log-19/"><![CDATA[<ul>
  <li>작성일 : 2022.05.27</li>
  <li>
    <p>작성자 : 황유진</p>
  </li>
  <li>팀원 : 김진영, 박승지, 반현빈, 오성은, 오은현, 황유진</li>
  <li>팀장 : 황유진</li>
  <li>부팀장 : 오성은</li>
  <li>GitHub Repository : <a href="https://github.com/miro7923/Uno-Mas">https://github.com/miro7923/Uno-Mas</a><br /><br /><br /></li>
</ul>

<h1 id="개발환경">개발환경</h1>
<ul>
  <li>MacBook Air (M1, 2020)</li>
  <li>OpenJDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>Spring framework 4.3.1.RELEASE</li>
  <li>Tomcat 8.5</li>
  <li>MySQL Workbench 8.0.19<br /><br /><br /></li>
</ul>

<h1 id="기간">기간</h1>
<ul>
  <li>2022.4.13 ~ 2022.5.27<br /><br /><br /></li>
</ul>

<h1 id="주제">주제</h1>
<ul>
  <li>웹 백엔드 수업 중 마지막 과제로 팀 프로젝트를 진행하게 되었다.</li>
  <li>조건은 <code class="language-plaintext highlighter-rouge">Spring</code> 기반으로 웹 사이트를 제작하는 것이다.</li>
  <li>총 팀원은 6명이며, 우리 팀은 <code class="language-plaintext highlighter-rouge">1인 가구를 위한 쇼핑몰</code>을 주제로 정했다.</li>
  <li>팀 이름으로 정해진 <code class="language-plaintext highlighter-rouge">Uno más</code>는 스페인어로 <code class="language-plaintext highlighter-rouge">하나 더</code>라는 뜻이다. <br /><br /><br /></li>
</ul>

<h1 id="진행상황">진행상황</h1>

<p align="center"><img src="../../assets/images/unomas_addrList1.png" width="500" /></p>

<ul>
  <li>쇼핑몰의 상품을 주문하는 페이지에서 배송지 목록 버튼을 클릭하면</li>
</ul>

<p align="center"><img src="../../assets/images/unomas_addrList2.png" width="900" /></p>

<ul>
  <li>배송지를 선택할 수 있는 새 창을 띄우고, 여기서 선택한 주소를 주문 페이지에 입력하는 기능을 추가했다.</li>
</ul>

<h2 id="shippinglocationjsp">shippingLocation.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
	pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"c"</span><span class="na"> uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"fn"</span><span class="na"> uri=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="nt">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span> <span class="na">style=</span><span class="s">"margin: 0px; padding: 0px; height: 100%; overflow: hidden;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>배송지 목록<span class="nt">&lt;/title&gt;</span>
	<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"${path}/resources/css/themify-icons.css?after"</span> <span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"${path}/resources/css/elegant-icons.css?after"</span> <span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"${path}/resources/css/order_css/shippingLocation.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span>
	<span class="na">style=</span><span class="s">"margin: 0px; padding: 0px; height: 100%; width: 100%; overflow: hidden;"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- @@@@@@@ 배송지 선택하면 주문 화면에서 신규배송지 탭에 출력되게 하기 --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pop_wrap"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pop_header"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"h1"</span><span class="nt">&gt;</span>배송지 목록<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pop_container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pop_content"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"delivery_list_area"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${sessionScope.saveNUM }"</span> <span class="na">id=</span><span class="s">"user_num"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${curPage }"</span> <span class="na">id=</span><span class="s">"curPage"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"tbl_delivery_list"</span><span class="nt">&gt;</span>    
                        <span class="nt">&lt;colgroup</span> <span class="na">width=</span><span class="s">"100%"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 140px;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: auto;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 150px;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 148px;"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;/colgroup&gt;</span>
                        <span class="nt">&lt;thead&gt;</span>
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="nt">&lt;th&gt;</span>배송지<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>주소<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>연락처<span class="nt">&lt;/th&gt;</span>
                                <span class="nt">&lt;th&gt;</span>선택<span class="nt">&lt;/th&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/thead&gt;</span>
                        <span class="nt">&lt;tbody&gt;</span>
                            <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">primaryAddr</span> <span class="o">!=</span> <span class="kc">null</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
	                            <span class="nt">&lt;tr</span> <span class="na">page=</span><span class="s">"1"</span> <span class="na">class=</span><span class="s">"_address default"</span> <span class="na">style=</span><span class="s">"display: table-row;"</span><span class="nt">&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_delivery"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_addressName nick"</span> <span class="na">id=</span><span class="s">"addr_nameP"</span><span class="nt">&gt;</span>${primaryAddr.addr_name }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"_receiverName name"</span> <span class="na">id=</span><span class="s">"addr_recipientP"</span><span class="nt">&gt;</span>${primaryAddr.addr_recipient }<span class="nt">&lt;/strong&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"mark_default"</span><span class="nt">&gt;</span>기본배송지<span class="nt">&lt;/span&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_zipCode zipcode"</span> <span class="na">id=</span><span class="s">"addr_postalcodeP"</span><span class="nt">&gt;</span>${primaryAddr.addr_postalcode }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_baseAddress"</span> <span class="na">id=</span><span class="s">"addr_roadaddrP"</span><span class="nt">&gt;</span>${primaryAddr.addr_roadaddr }<span class="nt">&lt;/span&gt;&lt;br&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_detailAddress"</span> <span class="na">id=</span><span class="s">"addr_detailaddrP"</span><span class="nt">&gt;</span>${primaryAddr.addr_detailaddr }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_roadNameYn"</span> <span class="na">style=</span><span class="s">"display:none;"</span><span class="nt">&gt;</span>Y<span class="nt">&lt;/span&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_tel"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_telNo1"</span><span class="nt">&gt;</span>${fn:substring(primaryAddr.addr_phone, 0, 3) } - ${fn:substring(primaryAddr.addr_phone, 3, 7) } - ${fn:substring(primaryAddr.addr_phone, 7, 11) }<span class="nt">&lt;/span&gt;&lt;br&gt;&lt;span</span> <span class="na">class=</span><span class="s">"_telNo2"</span><span class="nt">&gt;&lt;/span&gt;</span>
	                                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${primaryAddr.addr_phone }"</span> <span class="na">id=</span><span class="s">"addr_phoneP"</span><span class="nt">&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_btn"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"_select setting_btn type_h green"</span> <span class="na">onclick=</span><span class="s">"chooseLocation('P')"</span><span class="nt">&gt;</span>선택<span class="nt">&lt;/button&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;c:forEach </span><span class="na">var=</span><span class="s">"addrVO"</span><span class="na"> items=</span><span class="s">"</span><span class="si">${</span><span class="n">orderAddrList</span> <span class="si">}</span><span class="s">"</span><span class="na"> varStatus=</span><span class="s">"i"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;tr</span> <span class="na">page=</span><span class="s">"1"</span> <span class="na">class=</span><span class="s">"_address default"</span> <span class="na">style=</span><span class="s">"display: table-row;"</span><span class="nt">&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_delivery"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_addressName nick"</span> <span class="na">id=</span><span class="s">"addr_name${i.index }"</span><span class="nt">&gt;</span>${addrVO.addr_name }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"_receiverName name"</span> <span class="na">id=</span><span class="s">"addr_recipient${i.index }"</span><span class="nt">&gt;</span>${addrVO.addr_recipient }<span class="nt">&lt;/strong&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_zipCode zipcode"</span> <span class="na">id=</span><span class="s">"addr_postalcode${i.index }"</span><span class="nt">&gt;</span>${addrVO.addr_postalcode }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_baseAddress"</span> <span class="na">id=</span><span class="s">"addr_roadaddr${i.index }"</span><span class="nt">&gt;</span>${addrVO.addr_roadaddr }<span class="nt">&lt;/span&gt;&lt;br&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_detailAddress"</span> <span class="na">id=</span><span class="s">"addr_detailaddr${i.index }"</span><span class="nt">&gt;</span>${addrVO.addr_detailaddr }<span class="nt">&lt;/span&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_roadNameYn"</span> <span class="na">style=</span><span class="s">"display:none;"</span><span class="nt">&gt;</span>Y<span class="nt">&lt;/span&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_tel"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"_telNo1"</span><span class="nt">&gt;</span>${fn:substring(addrVO.addr_phone, 0, 3) } - ${fn:substring(addrVO.addr_phone, 3, 7) } - ${fn:substring(addrVO.addr_phone, 7, 11) }<span class="nt">&lt;/span&gt;&lt;br&gt;&lt;span</span> <span class="na">class=</span><span class="s">"_telNo2"</span><span class="nt">&gt;&lt;/span&gt;</span>
	                                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${addrVO.addr_phone }"</span> <span class="na">id=</span><span class="s">"addr_phone${i.index }"</span><span class="nt">&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"cell_btn"</span><span class="nt">&gt;</span>
	                                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"_select setting_btn type_h green"</span> <span class="na">onclick=</span><span class="s">"chooseLocation(${i.index})"</span><span class="nt">&gt;</span>선택<span class="nt">&lt;/button&gt;</span>
	                                <span class="nt">&lt;/td&gt;</span>
	                            <span class="nt">&lt;/tr&gt;</span>
                            <span class="nt">&lt;/c:forEach&gt;</span>
                        <span class="nt">&lt;/tbody&gt;</span>
                    <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"setting_paginate"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">pm</span><span class="o">.</span><span class="na">prev</span> <span class="o">==</span> <span class="kc">true</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
		                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/order/addr_book?user_num=${sessionScope.saveNUM }&amp;page=${reviewPm.startPage - 1 }"</span> 
		                <span class="na">id=</span><span class="s">"prev"</span> <span class="na">class=</span><span class="s">"page_btn_prev"</span> <span class="na">style=</span><span class="s">"color: black;"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"arrow_carrot-left_alt"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;c:forEach </span><span class="na">var=</span><span class="s">"page"</span><span class="na"> varStatus=</span><span class="s">"i"</span><span class="na"> begin=</span><span class="s">"</span><span class="si">${</span><span class="n">pm</span><span class="o">.</span><span class="na">startPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> end=</span><span class="s">"</span><span class="si">${</span><span class="n">pm</span><span class="o">.</span><span class="na">endPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> step=</span><span class="s">"1"</span><span class="nt">&gt;</span>
		                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:void(0);"</span> <span class="na">id=</span><span class="s">"page${i.index }"</span> <span class="na">style=</span><span class="s">"color: black;"</span> 
		                 <span class="na">class=</span><span class="s">"_page page_num"</span> <span class="na">onclick=</span><span class="s">"changePageNum(${i.index}, ${pm.endPage - pm.startPage + 1 })"</span><span class="nt">&gt;</span>${page }<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
	                <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">pm</span><span class="o">.</span><span class="na">next</span> <span class="o">==</span> <span class="kc">true</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
		                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/order/addr_book?user_num=${sessionScope.saveNUM }&amp;page=${reviewPm.endPage + 1 }"</span> 
		                <span class="na">id=</span><span class="s">"next"</span> <span class="na">class=</span><span class="s">"page_btn_next"</span> <span class="na">style=</span><span class="s">"color: black;"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"arrow_carrot-right_alt"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;</span>
	                <span class="nt">&lt;/c:if&gt;</span>
            	<span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pop_footer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"javascript:window.close();return false;"</span><span class="nt">&gt;</span>닫기<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery-3.3.1.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery-ui.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery.countdown.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery.nice-select.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery.zoom.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery.dd.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/jquery.slicknav.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/owl.carousel.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"${path}/resources/js/order_js/shippingLocation.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<ul>
  <li>페이지 템플릿은 네이버 쇼핑의 배송지 목록 템플릿을 참고해서 만들었다.(사실상 그냥 긁어왔…)</li>
  <li>태그의 클래스 선택자 이름이 출력하는 내용물의 용도에 맞게 지정되어 있어서 데이터를 넣는 <code class="language-plaintext highlighter-rouge">JSTL</code> 표현식을 쓸 때 정말 편했다. 역시 대기업은 다르다.</li>
</ul>

<h2 id="orderjsp">order.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"site-btn deliverListBtn"</span>
    <span class="na">onclick=</span><span class="s">"window.open('/order/addr_book?user_num=${sessionScope.saveNUM}&amp;pageNum=1');"</span><span class="nt">&gt;</span>배송지 목록<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<ul>
  <li>주문페이지에서 <code class="language-plaintext highlighter-rouge">배송지목록</code> 버튼을 클릭하면 이 템플릿 페이지가 새 창에서 열리도록 했다.</li>
</ul>

<h2 id="shippinglocationjsp-1">shippingLocation.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"_select setting_btn type_h green"</span> <span class="na">onclick=</span><span class="s">"chooseLocation(${i.index})"</span><span class="nt">&gt;</span>선택<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<ul>
  <li>배송지 목록 페이지에서 배송지를 선택하면 해당 배송지 데이터를 주문 페이지에 입력하는 메서드가 실행된다.</li>
</ul>

<h2 id="shippinglocationjs">shippingLocation.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">chooseLocation</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 신규배송지로 라디오버튼 선택 변경</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input:radio[name=deliverSpot]:radio[value="2"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="dl">'</span><span class="s1">checked</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#normalAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span> 

    <span class="c1">// 각 인풋태그값 세팅</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newName</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_recipient</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPhone1</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_phone</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPhone2</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_phone</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPhone3</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_phone</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">));</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPhone</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_phone</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPostalcode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_postalcode</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newRoadAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_roadaddr</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newDetailAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#addr_detailaddr</span><span class="dl">'</span><span class="o">+</span><span class="nx">num</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">window.opener</code> 메서드를 사용해 이 창을 연 부모 창에 데이터가 전달되도록 했다.</li>
</ul>

<p align="center"><img src="../../assets/images/unomas_addrList3.png" width="500" /></p>

<ul>
  <li>구현 완료~!<br /><br /><br /></li>
</ul>

<h1 id="구현하며-했던-고민">구현하며 했던 고민</h1>
<ul>
  <li>이번 기능을 구현해 본 적이 없어서 처음에 검색 키워드를 뭘로 해야 할 지 고민했었다. 평소 많이 보던 기능인데 뭐라 쳐야 관련 자료가 나올지 모르겠는 그런 느낌…ㅎ 쇼핑몰 배송지 목록 새창 이런 식으로 검색하면서 관련 자료를 찾았던 것 같다.<br /><br /><br /></li>
</ul>

<h1 id="마감까지">마감까지</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">D-0</code><br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://chobopark.tistory.com/247">[JQuery] AJAX테이블 생성 후 팝업창 데이터 전달&amp;인쇄 방법!! (영상 有)</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="Uno mas" /><category term="Project" /><category term="UnoMas" /><category term="Log" /><summary type="html"><![CDATA[작성일 : 2022.05.27 작성자 : 황유진]]></summary></entry><entry><title type="html">JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 18 - 결제기능 추가(아임포트 API)</title><link href="http://localhost:4000/uno%20mas/uno-mas-dev-log-18/" rel="alternate" type="text/html" title="JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 18 - 결제기능 추가(아임포트 API)" /><published>2022-05-26T00:00:00+09:00</published><updated>2022-05-26T00:00:00+09:00</updated><id>http://localhost:4000/uno%20mas/uno-mas-dev-log-18</id><content type="html" xml:base="http://localhost:4000/uno%20mas/uno-mas-dev-log-18/"><![CDATA[<ul>
  <li>작성일 : 2022.05.26</li>
  <li>
    <p>작성자 : 황유진</p>
  </li>
  <li>팀원 : 김진영, 박승지, 반현빈, 오성은, 오은현, 황유진</li>
  <li>팀장 : 황유진</li>
  <li>부팀장 : 오성은</li>
  <li>GitHub Repository : <a href="https://github.com/miro7923/Uno-Mas">https://github.com/miro7923/Uno-Mas</a><br /><br /><br /></li>
</ul>

<h1 id="개발환경">개발환경</h1>
<ul>
  <li>MacBook Air (M1, 2020)</li>
  <li>OpenJDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>Spring framework 4.3.1.RELEASE</li>
  <li>Tomcat 8.5</li>
  <li>MySQL Workbench 8.0.19<br /><br /><br /></li>
</ul>

<h1 id="기간">기간</h1>
<ul>
  <li>2022.4.13 ~ 2022.5.27<br /><br /><br /></li>
</ul>

<h1 id="주제">주제</h1>
<ul>
  <li>웹 백엔드 수업 중 마지막 과제로 팀 프로젝트를 진행하게 되었다.</li>
  <li>조건은 <code class="language-plaintext highlighter-rouge">Spring</code> 기반으로 웹 사이트를 제작하는 것이다.</li>
  <li>총 팀원은 6명이며, 우리 팀은 <code class="language-plaintext highlighter-rouge">1인 가구를 위한 쇼핑몰</code>을 주제로 정했다.</li>
  <li>팀 이름으로 정해진 <code class="language-plaintext highlighter-rouge">Uno más</code>는 스페인어로 <code class="language-plaintext highlighter-rouge">하나 더</code>라는 뜻이다. <br /><br /><br /></li>
</ul>

<h1 id="진행상황">진행상황</h1>

<p align="center"><img src="../../assets/images/unomas_pay1.png" width="900" /></p>

<ul>
  <li>쇼핑몰 결제기능을 추가했다!</li>
  <li>아임포트에서 개발자 연습용으로 무료로 제공하는 결제 API가 있어 이걸 이용했다.</li>
  <li>참고글</li>
  <li><a href="https://velog.io/@poseassome/%EA%B0%9C%EC%9D%B8%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%95%84%EC%9E%84%ED%8F%AC%ED%8A%B8import-%EA%B2%B0%EC%A0%9C-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">[개인프로젝트] 아임포트(i’mport) 결제 기능 구현하기</a></li>
  <li><a href="https://tyrannocoding.tistory.com/44">[JAVA, SPRING, Iamport] 아임포트 검증하기(WEB,APP)</a></li>
  <li><a href="https://github.com/iamport/iamport-manual">아임포트(iamport) 결제연동을 위한 매뉴얼 GitHub</a></li>
</ul>

<h2 id="pomxml">pom.xml</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;java-version&gt;</span>1.8<span class="nt">&lt;/java-version&gt;</span>
    <span class="nt">&lt;org.springframework-version&gt;</span>4.3.8.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
    <span class="nt">&lt;org.aspectj-version&gt;</span>1.6.10<span class="nt">&lt;/org.aspectj-version&gt;</span>
    <span class="nt">&lt;org.slf4j-version&gt;</span>1.6.6<span class="nt">&lt;/org.slf4j-version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>

<span class="c">&lt;!-- 상단 properties 아래에 추가 --&gt;</span>
<span class="nt">&lt;repositories&gt;</span>
  <span class="nt">&lt;repository&gt;</span>
    <span class="nt">&lt;id&gt;</span>jitpack.io<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;url&gt;</span>https://jitpack.io<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/repositories&gt;</span>

...

<span class="c">&lt;!-- dependencies 안에 추가 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.github.iamport<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>iamport-rest-client-java<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.2.14<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>시작 전에 결제 정보 검증을 위해 아임포트에서 제공하는 API를 사용할 수 있도록 의존성을 추가해 준다.</li>
</ul>

<h2 id="orderjs">order.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">IMP</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">IMP</span><span class="p">;</span> <span class="c1">// 생략 가능</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
	
    <span class="nx">IMP</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="dl">"</span><span class="s2">가맹점식별코드</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// 예: imp00000000</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li><a href="https://guide.iamport.kr/8f617f32-564d-464e-9850-bf7648c609b0">KG이니시스 테스트모드</a>로 진행할 것이다.</li>
  <li>
    <p>나는 <code class="language-plaintext highlighter-rouge">JSP</code> 페이지와 <code class="language-plaintext highlighter-rouge">JS</code> 파일을 따로 분리했기 때문에 <code class="language-plaintext highlighter-rouge">API</code> 호출을 위한 코드를 작성했다.</p>
  </li>
  <li>전체 코드</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">requestPay</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 수령자 배송지 설정 </span>
    <span class="kd">var</span> <span class="nx">addr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">postalcode</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input:radio[name=deliverSpot]:checked</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 기본배송지 사용</span>
        <span class="nx">addr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#roadAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#detailAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">postalcode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#postalcode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 신규배송지 사용</span>
        <span class="nx">addr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newRoadAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newDetailAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">postalcode</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newPostalcode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="p">}</span>
	
    <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="c1">// IMP.request_pay(param, callback) 결제창 호출</span>
    <span class="nx">IMP</span><span class="p">.</span><span class="nx">request_pay</span><span class="p">({</span> <span class="c1">// param</span>
        <span class="na">pg</span><span class="p">:</span> <span class="dl">"</span><span class="s2">html5_inicis</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">pay_method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">card</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">merchant_uid</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodName0</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">amount</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">buyer_email</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
        <span class="na">buyer_name</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userName</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
        <span class="na">buyer_tel</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#phone</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">buyer_addr</span><span class="p">:</span> <span class="nx">addr</span><span class="p">,</span>
        <span class="na">buyer_postcode</span><span class="p">:</span> <span class="nx">postalcode</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rsp</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// callback</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">rsp</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 결제 성공 시: 결제 승인 또는 가상계좌 발급에 성공한 경우</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">rsp</span><span class="p">.</span><span class="nx">imp_uid</span><span class="p">;</span>
            <span class="c1">// 결제검증</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/order/verify_iamport/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">rsp</span><span class="p">.</span><span class="nx">imp_uid</span><span class="p">,</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span>
            <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 결제를 요청했던 금액과 실제 결제된 금액이 같으면 해당 주문건의 결제가 정상적으로 완료된 것으로 간주한다.</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">data</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// jQuery로 HTTP 요청</span>
                    <span class="c1">// 주문정보 생성 및 테이블에 저장 </span>
                    <span class="c1">// @@ 주문정보는 상품 개수만큼 생성되어야 해서 상품 개수만큼 반복문을 돌린다</span>
                    <span class="c1">// 이때 order code는 모두 같아야 한다.</span>
                    <span class="kd">var</span> <span class="nx">roadAddr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">detailAddr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">recipient</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input:radio[name=deliverSpot]:checked</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">roadAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#roadAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">detailAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#detailAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">recipient</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#name</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">roadAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newRoadAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">detailAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newDetailAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                        <span class="nx">recipient</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newName</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                    <span class="p">}</span>
		        	
                    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodCnt</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// 데이터를 json으로 보내기 위해 바꿔준다.</span>
                        <span class="kd">var</span> <span class="nx">orderVO</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
                            <span class="na">order_code</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">cart_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cartNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">order_postalcode</span><span class="p">:</span> <span class="nx">postalcode</span><span class="p">,</span>
                            <span class="na">order_roadaddr</span><span class="p">:</span> <span class="nx">roadAddr</span><span class="p">,</span>
                            <span class="na">order_detailaddr</span><span class="p">:</span> <span class="nx">detailAddr</span><span class="p">,</span>
                            <span class="na">user_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userNum</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">prod_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">order_quantity</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodQuantity</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">order_total</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderTotal</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">user_point</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                            <span class="na">order_recipient</span><span class="p">:</span> <span class="nx">recipient</span><span class="p">,</span>
                            <span class="na">order_memo</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#ask</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
                        <span class="p">});</span>
					
                        <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                            <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/order/complete</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 예: https://www.myservice.com/payments/complete</span>
                            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
                            <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
                            <span class="na">contentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
                            <span class="na">data</span><span class="p">:</span> <span class="nx">orderVO</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
	        	
                    <span class="nx">createPayInfo</span><span class="p">(</span><span class="nx">uid</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제 실패</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">결제에 실패하였습니다. 에러 내용: </span><span class="dl">"</span> <span class="o">+</span>  <span class="nx">rsp</span><span class="p">.</span><span class="nx">error_msg</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">createPayInfo</span><span class="p">(</span><span class="nx">uid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 결제정보 생성 및 테이블 저장 후 결제완료 페이지로 이동 </span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/order/pay_info</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">imp_uid</span><span class="dl">'</span><span class="p">:</span> <span class="nx">uid</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">amount</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
            <span class="dl">'</span><span class="s1">ship</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#shippingFee</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
            <span class="dl">'</span><span class="s1">point</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제가 완료 되었습니다.</span><span class="dl">'</span><span class="p">);</span>
            <span class="c1">// 결제완료 페이지로 이동</span>
            <span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">/order/complete?pay_num=</span><span class="dl">'</span><span class="o">+</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제정보 저장 통신 실패</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>결제 부분</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
    <span class="c1">// IMP.request_pay(param, callback) 결제창 호출</span>
    <span class="nx">IMP</span><span class="p">.</span><span class="nx">request_pay</span><span class="p">({</span> <span class="c1">// param</span>
        <span class="na">pg</span><span class="p">:</span> <span class="dl">"</span><span class="s2">html5_inicis</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">pay_method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">card</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">merchant_uid</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodName0</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">amount</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">buyer_email</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
        <span class="na">buyer_name</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userName</span><span class="dl">'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
        <span class="na">buyer_tel</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#phone</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">buyer_addr</span><span class="p">:</span> <span class="nx">addr</span><span class="p">,</span>
        <span class="na">buyer_postcode</span><span class="p">:</span> <span class="nx">postalcode</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rsp</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// callback</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">rsp</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 결제 성공 시: 결제 승인 또는 가상계좌 발급에 성공한 경우</span>
            <span class="nx">uid</span> <span class="o">=</span> <span class="nx">rsp</span><span class="p">.</span><span class="nx">imp_uid</span><span class="p">;</span>
            <span class="c1">// 결제검증</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/order/verify_iamport/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">rsp</span><span class="p">.</span><span class="nx">imp_uid</span><span class="p">,</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span>
            <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>먼저 결제 정보를 아임포트 서버로 보내 결제를 완료한다.</li>
  <li>결제가 완료되면 결제 정보를 담은 json 데이터가 리턴된다. 여기서 결제건의 인덱스 번호인 <code class="language-plaintext highlighter-rouge">imp_uid</code>를 이용해 정말 정상적으로 결제가 된 것인지 검증을 하기 위해 이동한다.</li>
</ul>

<h2 id="아임포트-결제모듈-테스트">아임포트 결제모듈 테스트</h2>
<ul>
  <li>
    <p><a href="https://github.com/iamport/iamport-rest-client-java/blob/master/src/test/java/com/siot/IamportRestClient/IamportRestTest.java">아임포트 결제모듈 테스트 ver.JAVA</a></p>
  </li>
  <li>
    <p>시작 전에 아임포트사에서 제공하는 테스트 코드를 따라 써 보면서 테스트를 진행했다. API에서 제공되는 객체와 메서드들이 어떤 것들이 있는지 살펴보기 좋았다. 전체적으로 개발자에게 아주 친절한 느낌!</p>
  </li>
</ul>

<h2 id="ordercontrollerjava">OrderController.java</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">IamportClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IamportClient</span><span class="o">(</span><span class="s">"REST API"</span><span class="o">,</span> <span class="s">"REST API Secret"</span><span class="o">);</span>

<span class="nd">@ResponseBody</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/verify_iamport/{imp_uid}"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">IamportResponse</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="nf">verifyIamportPOST</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"imp_uid"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">imp_uid</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IamportResponseException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">paymentByImpUid</span><span class="o">(</span><span class="n">imp_uid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>아까 리턴받은 결제 번호를 이용해 서버에 해당 결제 정보가 있는지 확인한 뒤 가져온다.</li>
  <li>아임포트 서버에 접속해서 정보를 가져오기 위해서는 그냥은 안 되고 인증에 필요한 <code class="language-plaintext highlighter-rouge">key</code> 정보가 있어야 하기 때문에 내 계정에서 <code class="language-plaintext highlighter-rouge">key</code> 정보를 가져와서 넣어준다.</li>
  <li><a href="https://github.com/iamport/iamport-rest-client-java">iamport REST Client for JAVA</a> 아임포트사에서 제공하는 공식 문서를 참고해서 진행했다. 정리가 잘 되어 있어 보기 편했다.</li>
</ul>

<h2 id="orderjs-1">order.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 결제검증</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/order/verify_iamport/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">rsp</span><span class="p">.</span><span class="nx">imp_uid</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 결제를 요청했던 금액과 실제 결제된 금액이 같으면 해당 주문건의 결제가 정상적으로 완료된 것으로 간주한다.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">data</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// jQuery로 HTTP 요청</span>
        <span class="c1">// 주문정보 생성 및 테이블에 저장 </span>
        <span class="c1">// @@ 주문정보는 상품 개수만큼 생성되어야 해서 상품 개수만큼 반복문을 돌린다</span>
        <span class="c1">// 이때 order code는 모두 같아야 한다.</span>
        
        <span class="c1">// 이번 주문의 배송지 설정 </span>
        <span class="kd">var</span> <span class="nx">roadAddr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">detailAddr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">recipient</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
        
        <span class="c1">// 기본 배송지로 설정된 경우</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input:radio[name=deliverSpot]:checked</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">roadAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#roadAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="nx">detailAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#detailAddr</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="nx">recipient</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#name</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// 신규 배송지로 설정된 경우 </span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">roadAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newRoadAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="nx">detailAddr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newDetailAddress</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
            <span class="nx">recipient</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#newName</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodCnt</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 데이터를 json으로 보내기 위해 바꿔준다.</span>
            <span class="kd">var</span> <span class="nx">orderVO</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
                <span class="na">order_code</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">cart_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cartNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">order_postalcode</span><span class="p">:</span> <span class="nx">postalcode</span><span class="p">,</span>
                <span class="na">order_roadaddr</span><span class="p">:</span> <span class="nx">roadAddr</span><span class="p">,</span>
                <span class="na">order_detailaddr</span><span class="p">:</span> <span class="nx">detailAddr</span><span class="p">,</span>
                <span class="na">user_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userNum</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">prod_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">order_quantity</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodQuantity</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">order_total</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderTotal</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">user_point</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">order_recipient</span><span class="p">:</span> <span class="nx">recipient</span><span class="p">,</span>
                <span class="na">order_memo</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#ask</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">});</span>
        
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/order/complete</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 예: https://www.myservice.com/payments/complete</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">contentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="nx">orderVO</span>
            <span class="p">});</span>
        <span class="p">}</span>
    
        <span class="nx">createPayInfo</span><span class="p">(</span><span class="nx">uid</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제 실패</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>결제 검증이 완료되면 주문 정보를 생성해서 DB 테이블에 저장해야 한다.</li>
  <li>우리 프로젝트에는 주문정보를 저장하는 테이블과 결제정보를 저장하는 테이블 두 개가 존재한다. 두 개를 따로 둔 이유는 하나의 결제건에 대해서 어떤 상품들을 주문했는지를 알 수 있어야 하기 때문이다.</li>
  <li>만약 결제테이블 하나만 써서 고객의 결제정보를 관리한다면 DB 테이블의 로우 하나에는 상품정보 하나만 저장할 수 있다. 하지만 쇼핑몰에서 고객은 항상 하나의 상품만 주문하지 않고 여러 개의 상품을 주문할 수 있다. 이 때 각 상품을 어떤 옵션으로 몇 개를 주문했는지도 알고 있어야 그걸 참고해서 상품을 배송할 수 있고 고객 문의를 처리하거나 고객에게 결제건에 대한 정보를 제공할 때 사용할 수 있다.</li>
  <li>그래서 주문테이블을 따로 두어서 하나의 결제건에서 다수의 상품이 주문되었을 경우 각 상품 정보를 저장할 수 있도록 했다. 이때 <code class="language-plaintext highlighter-rouge">PK</code>는 주문번호와 상품번호를 복합키로 사용했다. 주문테이블의 데이터는 고유한 <code class="language-plaintext highlighter-rouge">PK</code>가 있어야 각 주문건을 구별할 수 있는데 주문번호만 <code class="language-plaintext highlighter-rouge">PK</code>로 두면 주문번호 하나에 상품정보 하나만 들어갈 수 있기 때문에 주문테이블과 결제테이블을 따로 사용하는 의미가 없어진다.</li>
</ul>

<p align="center"><img src="../../assets/images/unomas_pay2.png" width="900" /></p>

<ul>
  <li>그런데 주문번호와 상품번호를 복합키로 사용하면 어떤 주문번호로 그에 해당되는 상품정보를 모두 불러올 수 있고 여러개의 주문번호도 등록할 수 있다. 그리고 각 상품을 몇 개 주문했는지에 대한 정보도 저장할 수 있다.</li>
  <li>그렇기 때문에 주문정보를 DB 테이블에 저장하기 위해서는 이번 결제건에서 주문된 상품 종류의 개수만큼 반복문을 돌려 주문정보를 생성해야 한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ResponseBody</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/complete"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">completePOST</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">OrderVO</span> <span class="n">vo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// 결제 완료된 주문정보 DB에 저장</span>
    <span class="n">orderService</span><span class="o">.</span><span class="na">createOrder</span><span class="o">(</span><span class="n">vo</span><span class="o">);</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="s">"주문정보 생성 완료"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodCnt</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 데이터를 json으로 보내기 위해 바꿔준다.</span>
    <span class="kd">var</span> <span class="nx">orderVO</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="na">order_code</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">cart_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cartNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_postalcode</span><span class="p">:</span> <span class="nx">postalcode</span><span class="p">,</span>
        <span class="na">order_roadaddr</span><span class="p">:</span> <span class="nx">roadAddr</span><span class="p">,</span>
        <span class="na">order_detailaddr</span><span class="p">:</span> <span class="nx">detailAddr</span><span class="p">,</span>
        <span class="na">user_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userNum</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">prod_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_quantity</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodQuantity</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_total</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderTotal</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">user_point</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_recipient</span><span class="p">:</span> <span class="nx">recipient</span><span class="p">,</span>
        <span class="na">order_memo</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#ask</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="p">});</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/order/complete</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 예: https://www.myservice.com/payments/complete</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">contentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">orderVO</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">createPayInfo</span><span class="p">(</span><span class="nx">uid</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>주문정보를 모두 생성하고 나면 결제 정보를 생성하기 위한 메서드 <code class="language-plaintext highlighter-rouge">createPayInfo(uid)</code>를 호출한다.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createPayInfo</span><span class="p">(</span><span class="nx">uid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 결제정보 생성 및 테이블 저장 후 결제완료 페이지로 이동 </span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/order/pay_info</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">imp_uid</span><span class="dl">'</span><span class="p">:</span> <span class="nx">uid</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">amount</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#total</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
            <span class="dl">'</span><span class="s1">ship</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#shippingFee</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
            <span class="dl">'</span><span class="s1">point</span><span class="dl">'</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제가 완료 되었습니다.</span><span class="dl">'</span><span class="p">);</span>
            <span class="c1">// 결제완료 페이지로 이동</span>
            <span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">/order/complete?pay_num=</span><span class="dl">'</span><span class="o">+</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제정보 저장 통신 실패</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>결제 정보 생성을 위해 필요한 정보를 추가적으로 담은 후 해당 <code class="language-plaintext highlighter-rouge">url</code>로 이동한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/pay_info"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">payInfoPOST</span><span class="o">(</span><span class="nc">Model</span> <span class="n">model</span><span class="o">,</span>
        <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
        <span class="nd">@RequestParam</span> <span class="nc">String</span> <span class="n">imp_uid</span><span class="o">,</span> <span class="nd">@RequestParam</span> <span class="kt">int</span> <span class="n">amount</span><span class="o">,</span>
        <span class="nd">@RequestParam</span> <span class="kt">int</span> <span class="n">ship</span><span class="o">,</span> <span class="nd">@RequestParam</span> <span class="kt">double</span> <span class="n">point</span><span class="o">,</span> <span class="nc">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    
    <span class="nc">IamportResponse</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">paymentByImpUid</span><span class="o">(</span><span class="n">imp_uid</span><span class="o">);</span>
        
    <span class="c1">// 결제 정보 저장</span>
    <span class="nc">PayVO</span> <span class="n">payVO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PayVO</span><span class="o">();</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setOrder_code</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getMerchantUid</span><span class="o">()));</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_card_company</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getCardName</span><span class="o">());</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_card_num</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getCardNumber</span><span class="o">());</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_installment</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getCardQuota</span><span class="o">());</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_method</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getPayMethod</span><span class="o">());</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getMerchantUid</span><span class="o">()));</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_shippingfee</span><span class="o">(</span><span class="n">ship</span><span class="o">);</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setPay_total_price</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getAmount</span><span class="o">().</span><span class="na">intValue</span><span class="o">());</span>
    <span class="n">payVO</span><span class="o">.</span><span class="na">setUser_num</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"saveNUM"</span><span class="o">));</span>
    
    <span class="n">orderService</span><span class="o">.</span><span class="na">createPay</span><span class="o">(</span><span class="n">payVO</span><span class="o">);</span>
    
    <span class="c1">// 방금 생성된 결제 정보의 인덱스 번호 가져옴 </span>
    <span class="n">payVO</span> <span class="o">=</span> <span class="n">orderService</span><span class="o">.</span><span class="na">getLastPay</span><span class="o">();</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"payVO"</span><span class="o">,</span> <span class="n">payVO</span><span class="o">);</span>
    
    <span class="c1">// 회원 적립금 추가</span>
    <span class="n">userService</span><span class="o">.</span><span class="na">updatePoint</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"saveNUM"</span><span class="o">),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">point</span><span class="o">);</span>
    
    <span class="c1">// 적립금 테이블에 내역 추가</span>
    <span class="nc">PointVO</span> <span class="n">pointVO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PointVO</span><span class="o">();</span>
    <span class="n">pointVO</span><span class="o">.</span><span class="na">setOrder_code</span><span class="o">(</span><span class="n">payVO</span><span class="o">.</span><span class="na">getOrder_code</span><span class="o">());</span>
    <span class="n">pointVO</span><span class="o">.</span><span class="na">setPoint_content</span><span class="o">(</span><span class="s">"결제"</span><span class="o">);</span>
    <span class="n">pointVO</span><span class="o">.</span><span class="na">setPoint_cost</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">point</span><span class="o">);</span>
    <span class="n">pointVO</span><span class="o">.</span><span class="na">setUser_num</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"saveNUM"</span><span class="o">));</span>
    
    <span class="n">orderService</span><span class="o">.</span><span class="na">createPointInfo</span><span class="o">(</span><span class="n">pointVO</span><span class="o">);</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;(</span><span class="n">payVO</span><span class="o">.</span><span class="na">getPay_num</span><span class="o">(),</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>결제 정보는 아임포트 서버에서 불러와 생성한다.</li>
  <li>결제 번호 컬럼에 <code class="language-plaintext highlighter-rouge">Auto increasement</code> 속성을 걸어 놓아서 테이블에 데이터가 삽입될 때 결제 번호가 결정된다. 결제 완료 화면에 결저 번호도 뿌려줄 것이라 결제 정보를 저장한 뒤 해당 정보를 다시 가져와서 <code class="language-plaintext highlighter-rouge">model</code> 객체에 저장하도록 했다.</li>
  <li>
    <p>결제 정보 저장이 완료되면 결제번호 정보를 리턴한다.</p>
  </li>
  <li>여기까지 하면 모든 결제 프로세스가 완료되고 결제완료 페이지로 이동한다.<br /><br /><br /></li>
</ul>

<h1 id="구현하며-했던-고민">구현하며 했던 고민</h1>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodCnt</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 데이터를 json으로 보내기 위해 바꿔준다.</span>
    <span class="kd">var</span> <span class="nx">orderVO</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="na">order_code</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderCode</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">cart_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cartNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_postalcode</span><span class="p">:</span> <span class="nx">postalcode</span><span class="p">,</span>
        <span class="na">order_roadaddr</span><span class="p">:</span> <span class="nx">roadAddr</span><span class="p">,</span>
        <span class="na">order_detailaddr</span><span class="p">:</span> <span class="nx">detailAddr</span><span class="p">,</span>
        <span class="na">user_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userNum</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">prod_num</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodNum</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_quantity</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prodQuantity</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_total</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#orderTotal</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">user_point</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#userPoint</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="na">order_recipient</span><span class="p">:</span> <span class="nx">recipient</span><span class="p">,</span>
        <span class="na">order_memo</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#ask</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="p">});</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/order/complete</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 예: https://www.myservice.com/payments/complete</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">contentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">orderVO</span><span class="p">,</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">주문정보 생성 실패!</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>처음에는 <code class="language-plaintext highlighter-rouge">requestPay()</code> 메서드의 주문정보를 생성하는 부분을 이런식으로 작성해서 통신의 성공 유무를 확인하려 했다. 그런데 통신에 실패해서 주문정보 생성에 실패했다는 메시지가 출력되는데 주문정보는 내가 의도한 대로 생성이 잘 되는… 결과적으로 동작에는 아무 문제가 없는 상황이 발생되었다. 원인이 궁금해서 정말 여러 가지 방법으로 테스트를 해 보았지만 주문 정보 생성은 정말정말 잘 되는데 에러 데이터는 계속 리턴되는 희안한 상황이 계속되었다. 아직까지도 원인을 못 찾음…</li>
  <li>프로젝트 진행 마감날도 다가오고 일단 전체적인 동작에는 문제가 없기 때문에 <code class="language-plaintext highlighter-rouge">ajax</code> 통신의 <code class="language-plaintext highlighter-rouge">success</code> 이하 부분은 삭제하고 가기로 했다.<br /><br /><br /></li>
</ul>

<h1 id="마감까지">마감까지</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">D-1</code><br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://velog.io/@poseassome/%EA%B0%9C%EC%9D%B8%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%95%84%EC%9E%84%ED%8F%AC%ED%8A%B8import-%EA%B2%B0%EC%A0%9C-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">[개인프로젝트] 아임포트(i’mport) 결제 기능 구현하기</a></li>
  <li><a href="https://tyrannocoding.tistory.com/44">[JAVA, SPRING, Iamport] 아임포트 검증하기(WEB,APP)</a></li>
  <li><a href="https://github.com/iamport/iamport-manual">아임포트(iamport) 결제연동을 위한 매뉴얼 GitHub</a></li>
  <li><a href="https://api.iamport.kr/">아임포트 REST API</a></li>
  <li><a href="https://github.com/iamport/iamport-rest-client-java">iamport REST Client for JAVA</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="Uno mas" /><category term="Project" /><category term="UnoMas" /><category term="Log" /><summary type="html"><![CDATA[작성일 : 2022.05.26 작성자 : 황유진]]></summary></entry><entry><title type="html">에러해결 Log) 깃허브(GitHub) 새로 만든 파일이 갑자기 인식이 안 될 때</title><link href="http://localhost:4000/errorlog/warning-log-13/" rel="alternate" type="text/html" title="에러해결 Log) 깃허브(GitHub) 새로 만든 파일이 갑자기 인식이 안 될 때" /><published>2022-05-25T00:00:00+09:00</published><updated>2022-05-25T00:00:00+09:00</updated><id>http://localhost:4000/errorlog/warning-log-13</id><content type="html" xml:base="http://localhost:4000/errorlog/warning-log-13/"><![CDATA[<h1 id="사용환경">사용환경</h1>
<ul>
  <li>MacBook Air (M1, 2020) 16GB</li>
  <li>JDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>tomcat 8.5<br /><br /><br /></li>
</ul>

<h1 id="에러의-발생">에러의 발생</h1>

<p align="center"><img src="../../assets/images/gitError0525_1.png" width="500" /></p>

<ul>
  <li>이클립스에서 스프링 프로젝트를 진행하며 새로운 <code class="language-plaintext highlighter-rouge">JSP</code> 파일을 만들었는데 이런 식으로 인식이 되지 않는 것이었다.(당시 캡쳐본이 없어서 <code class="language-plaintext highlighter-rouge">.gitignore</code>에 등록된 파일로 대체함)</li>
  <li><code class="language-plaintext highlighter-rouge">.gitignore</code>에도 등록되어 있지 않은 파일인데 뭔 짓을 해도 인식되지 않고 <code class="language-plaintext highlighter-rouge">force</code> 명령어를 써서 파일을 직접 등록해줘야 원격저장소에 업로드가 가능했다.<br /><br /><br /></li>
</ul>

<h1 id="문제-해결">문제 해결</h1>

<p align="center"><img src="../../assets/images/gitError0525_2.png" width="500" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.gitignore</code>의 맨 밑에 프로젝트 폴더가 등록되어 있던 것이 문제였다… 저게 도대체 왜 갑자기 들어간건지; 황당하네 😦</li>
  <li>지워준 뒤 <code class="language-plaintext highlighter-rouge">Add to index</code> 하니까 문제 없이 인식이 잘 되었다.</li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="ErrorLog" /><category term="Error" /><category term="Solve" /><category term="Log" /><summary type="html"><![CDATA[사용환경 MacBook Air (M1, 2020) 16GB JDK 8 Spring Tool Suite 4.14.0 tomcat 8.5]]></summary></entry><entry><title type="html">에러해결 Log) (Spring framework) NoSuchBeanDefinitionException No qualifying bean of type ‘com.xxx’ available</title><link href="http://localhost:4000/errorlog/warning-log-12/" rel="alternate" type="text/html" title="에러해결 Log) (Spring framework) NoSuchBeanDefinitionException No qualifying bean of type ‘com.xxx’ available" /><published>2022-05-24T00:00:00+09:00</published><updated>2022-05-24T00:00:00+09:00</updated><id>http://localhost:4000/errorlog/warning-log-12</id><content type="html" xml:base="http://localhost:4000/errorlog/warning-log-12/"><![CDATA[<h1 id="사용환경">사용환경</h1>
<ul>
  <li>MacBook Air (M1, 2020) 16GB</li>
  <li>JDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>tomcat 8.5<br /><br /><br /></li>
</ul>

<h1 id="에러의-발생">에러의 발생</h1>

<p align="center"><img src="../../assets/images/repoError1.png" /></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 
'com.april.unomas.service.OrderService' available: expected at least 1 bean which qualifies 
as autowire candidate. Dependency annotations: {@javax.inject.Inject()}
... 이하 생략
}
</code></pre></div></div>

<ul>
  <li>새로운 <code class="language-plaintext highlighter-rouge">DAO</code>랑 <code class="language-plaintext highlighter-rouge">Service</code> 클래스를 추가했는데 이런 에러 메시지가 뜨면서 서버 실행이 돼지 않았다. 찾을 수 없다고 하는 클래스들은 모두 만들어져 있었다.<br /><br /><br /></li>
</ul>

<h1 id="문제-해결">문제 해결</h1>

<p align="center"><img src="../../assets/images/repoError2.png" width="500" /></p>

<ul>
  <li>문제는 <code class="language-plaintext highlighter-rouge">DAO</code>와 <code class="language-plaintext highlighter-rouge">Service</code>를 구현하는 클래스에 <code class="language-plaintext highlighter-rouge">@Repository</code>와 <code class="language-plaintext highlighter-rouge">@Service</code>를 지정해 주지 않았던 것이었다…🥲 이걸 왜 까먹었을까…</li>
</ul>

<p align="center"><img src="../../assets/images/repoError3.png" width="500" /></p>

<ul>
  <li>각각 필요한 어노테이션들을 달아주니까 정상작동 되었다.<br /><br /><br /></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="ErrorLog" /><category term="Error" /><category term="Solve" /><category term="Log" /><summary type="html"><![CDATA[사용환경 MacBook Air (M1, 2020) 16GB JDK 8 Spring Tool Suite 4.14.0 tomcat 8.5]]></summary></entry><entry><title type="html">JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 17 - 새로고침 없이 게시판 목록 불러오기</title><link href="http://localhost:4000/uno%20mas/uno-mas-dev-log-17/" rel="alternate" type="text/html" title="JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 17 - 새로고침 없이 게시판 목록 불러오기" /><published>2022-05-22T00:00:00+09:00</published><updated>2022-05-22T00:00:00+09:00</updated><id>http://localhost:4000/uno%20mas/uno-mas-dev-log-17</id><content type="html" xml:base="http://localhost:4000/uno%20mas/uno-mas-dev-log-17/"><![CDATA[<ul>
  <li>작성일 : 2022.05.22</li>
  <li>
    <p>작성자 : 황유진</p>
  </li>
  <li>팀원 : 김진영, 박승지, 반현빈, 오성은, 오은현, 황유진</li>
  <li>팀장 : 황유진</li>
  <li>부팀장 : 오성은</li>
  <li>GitHub Repository : <a href="https://github.com/miro7923/Uno-Mas">https://github.com/miro7923/Uno-Mas</a><br /><br /><br /></li>
</ul>

<h1 id="개발환경">개발환경</h1>
<ul>
  <li>MacBook Air (M1, 2020)</li>
  <li>OpenJDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>Spring framework 4.3.1.RELEASE</li>
  <li>Tomcat 8.5</li>
  <li>MySQL Workbench 8.0.19<br /><br /><br /></li>
</ul>

<h1 id="기간">기간</h1>
<ul>
  <li>2022.4.13 ~ 2022.5.27<br /><br /><br /></li>
</ul>

<h1 id="주제">주제</h1>
<ul>
  <li>웹 백엔드 수업 중 마지막 과제로 팀 프로젝트를 진행하게 되었다.</li>
  <li>조건은 <code class="language-plaintext highlighter-rouge">Spring</code> 기반으로 웹 사이트를 제작하는 것이다.</li>
  <li>총 팀원은 6명이며, 우리 팀은 <code class="language-plaintext highlighter-rouge">1인 가구를 위한 쇼핑몰</code>을 주제로 정했다.</li>
  <li>팀 이름으로 정해진 <code class="language-plaintext highlighter-rouge">Uno más</code>는 스페인어로 <code class="language-plaintext highlighter-rouge">하나 더</code>라는 뜻이다. <br /><br /><br /></li>
</ul>

<h1 id="진행상황">진행상황</h1>

<p align="center"><img src="../../assets/images/unomas_prodBoard1.png" width="900" /></p>

<ul>
  <li>상품 상세페이지에 있는 후기와 문의 게시판의 하단에 있는 페이지 번호를 클릭하면 다음 글 목록을 보여주는 기능을 만들었다. 그런데 페이지의 새로고침 없이 보여주는 기능을 곁들인</li>
  <li><a href="https://backstreet-programmer.tistory.com/105">[Web] ajax으로 받아온 data를 jstl로 표현하기</a></li>
  <li><a href="https://velog.io/@hwarkhada/ajax%EB%A1%9C-%EB%B0%9B%EC%95%84%EC%98%A8-data-%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8-%EC%97%86%EC%9D%B4-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0">ajax로 받아온 data 페이지 새로고침 없이 사용하기</a></li>
  <li>위 두 글을 참고해서 <code class="language-plaintext highlighter-rouge">Ajax</code>로 가져온 데이터를 새로고침 없이 출력하게 구현했다. 이 과정에서 <code class="language-plaintext highlighter-rouge">append</code> 메서드를 사용해 작성된 태그를 갈아 붙이는 방식이 널리 사용되고 있었지만 나는 이런 방식이 좀 비효율적으로 느껴졌다. 그리고 코드도 지저분해 보였다.</li>
  <li>그래서 임시 페이지에 똑같은 게시판을 만들어 놓고 임시 페이지를 새로고침해서 게시글 목록을 갱신한 다음에 원본 페이지에 있는 게시판을 임시 페이지의 게시판으로 바꾸는 방식으로 구현했다.</li>
</ul>

<h2 id="productmapperxml">productMapper.xml</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getReviewList"</span> <span class="na">resultType=</span><span class="s">"BoardReviewVO"</span><span class="nt">&gt;</span>
    SELECT *
    FROM board_review
    WHERE prod_num = #{prod_num}
    ORDER BY review_regdate DESC
    LIMIT #{pageStart}, #{perPageNum}
<span class="nt">&lt;/select&gt;</span>
</code></pre></div></div>

<ul>
  <li>게시글 목록을 가져올 때엔 정해진 개수만큼만 가져온다. 모든 목록을 가져오면 게시글의 수가 1000개, 100000개 이상으로 아주아주 많아지면 하염없이 게시글 목록만 불러오고 있을 것이다.</li>
</ul>

<h2 id="productdetailjsp">productDetail.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;c:forEach </span><span class="na">var=</span><span class="s">"block"</span><span class="na"> varStatus=</span><span class="s">"it"</span><span class="na"> begin=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">startPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> end=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">endPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> step=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span&gt;</span>
        <span class="c">&lt;!----&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:void(0)"</span> 
        <span class="na">class=</span><span class="s">"pagingBtn"</span> <span class="na">id=</span><span class="s">"reviewPage${it.index }"</span> <span class="na">style=</span><span class="s">"color: black;"</span>
        <span class="na">onclick=</span><span class="s">"changePageNum(${it.index }, ${reviewPm.endPage - reviewPm.startPage + 1 }, 'review');"</span><span class="nt">&gt;</span>${block } <span class="c">&lt;!----&gt;</span><span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/span&gt;</span> 
<span class="nt">&lt;/c:forEach&gt;</span>
</code></pre></div></div>

<ul>
  <li>먼저 뷰 페이지에서 페이지 번호를 클릭할 수 있도록 만든다. 게시글의 총 개수를 세어서 필요한 만큼 페이지 번호를 생성한다.</li>
  <li>클릭하면 자바스크립트 메서드가 호출된다.</li>
</ul>

<h2 id="productdetailjs">productDetail.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">changePageNum</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">maxNum</span><span class="p">,</span> <span class="nx">boardType</span><span class="p">)</span> <span class="p">{</span>    
    <span class="k">if</span> <span class="p">(</span><span class="nx">boardType</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">review</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">initReview</span><span class="p">();</span>
	    
        <span class="c1">// 선택된 페이지 번호 강조 처리 </span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#reviewPage</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
	    
        <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">font-weight</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bold</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#B9CE45</span><span class="dl">'</span><span class="p">);</span>
	    
        <span class="c1">// 나머지 번호들은 강조 처리 해제 </span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">maxNum</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">num</span> <span class="o">==</span> <span class="nx">i</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
	        
            <span class="nx">id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#reviewPage</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">font-weight</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">black</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
	    
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/product/list_review?prod_num=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prod_num</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&amp;page=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">,</span>
            <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">결과: </span><span class="dl">'</span><span class="o">+</span><span class="nx">data</span><span class="p">);</span>
                <span class="c1">// 임시 페이지에 출력된 데이터를 가져와 원본 페이지의 데이터를 바꿔준다.</span>
                <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#reviewListAjax</span><span class="dl">'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
				
                <span class="nx">getPageNum</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">통신 실패</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">initQna</span><span class="p">();</span>
		
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#inquiryPage</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">;</span>
	    
        <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">font-weight</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bold</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">#B9CE45</span><span class="dl">'</span><span class="p">);</span>
	    
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">maxNum</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">num</span> <span class="o">==</span> <span class="nx">i</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
	        
            <span class="nx">id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#inquiryPage</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">font-weight</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">black</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
	    
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/product/list_inquiry?prod_num=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prod_num</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&amp;page=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">,</span>
            <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#inqDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

                <span class="nx">getPageNum</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">통신 실패</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
		
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>다음 페이지의 글 목록을 불러오는 메서드가 호출되면 <code class="language-plaintext highlighter-rouge">Ajax</code> 통신으로 서버에 접속해 임시 페이지를 새로고침 하는 동작을 수행한 뒤 돌아온다.</li>
  <li>이제 임시 페이지에 있는 새 데이터를 원본 페이지의 게시판에 덮어씌워주면 작업이 끝난다.</li>
</ul>

<h2 id="revboardajaxjsp">revBoardAjax.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
	pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"c"</span><span class="na"> uri=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"fmt"</span><span class="na"> uri=</span><span class="s">"http://java.sun.com/jsp/jstl/fmt"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"fn"</span><span class="na"> uri=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@taglib </span><span class="na">prefix=</span><span class="s">"spring"</span><span class="na"> uri=</span><span class="s">"http://www.springframework.org/tags"</span> <span class="nt">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"comment-option"</span> <span class="na">id=</span><span class="s">"reviewListAjax"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"reviewTable"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">border=</span><span class="s">"0"</span> <span class="na">cellpadding=</span><span class="s">"0"</span> <span class="na">cellspacing=</span><span class="s">"0"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;caption</span> <span class="na">style=</span><span class="s">"display: none"</span><span class="nt">&gt;</span>구매후기 제목<span class="nt">&lt;/caption&gt;</span>
            <span class="nt">&lt;colgroup&gt;</span>
                <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 110px;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: auto;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 77px;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 100px;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 80px;"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/colgroup&gt;</span>
            <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th&gt;</span>번호<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>제목<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th</span> <span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>작성자<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>작성일<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>조회<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;c:choose&gt;</span>
            <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="nl">fn:</span><span class="n">length</span><span class="o">(</span><span class="n">reviewList</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-center nonPost"</span><span class="nt">&gt;</span>등록된 후기가 없어요. 고객님께서 첫 번째 후기를 남겨주세요!<span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;/c:when&gt;</span>
            <span class="nt">&lt;c:otherwise&gt;</span>
                <span class="nt">&lt;c:forEach </span><span class="na">var=</span><span class="s">"reviewVo"</span><span class="na"> items=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewList</span> <span class="si">}</span><span class="s">"</span><span class="na"> varStatus=</span><span class="s">"it"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"reviewTable"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">border=</span><span class="s">"0"</span> <span class="na">cellpadding=</span><span class="s">"0"</span> <span class="na">cellspacing=</span><span class="s">"0"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;caption</span> <span class="na">style=</span><span class="s">"display: none"</span><span class="nt">&gt;</span>구매후기 제목<span class="nt">&lt;/caption&gt;</span>
                        <span class="nt">&lt;colgroup&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 110px;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: auto;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 77px;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 100px;"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;col</span> <span class="na">style=</span><span class="s">"width: 80px;"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;/colgroup&gt;</span>
                        <span class="nt">&lt;tbody&gt;</span>
                            <span class="nt">&lt;tr</span> <span class="na">onmouseover=</span><span class="s">"this.style.background='#f0f0f0'"</span>
                                <span class="na">onmouseout=</span><span class="s">"this.style.background='white'"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">id=</span><span class="s">"reviewNum${it.index }"</span><span class="nt">&gt;</span>${reviewVo.review_num }<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">align=</span><span class="s">"left"</span> <span class="na">class=</span><span class="s">"reviewTitle"</span> <span class="na">id=</span><span class="s">"reviewTitle${it.index }"</span>
                                    <span class="na">onclick=</span><span class="s">"updateReviewReadcnt(${it.index}); toggleReview(${it.index});"</span><span class="nt">&gt;</span>${reviewVo.review_title }<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">align=</span><span class="s">"left"</span> <span class="na">id=</span><span class="s">"reviewUserid${it.index }"</span><span class="nt">&gt;</span>${reviewVo.user_id }<span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">id=</span><span class="s">"reviewRegdate${it.index }"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;fmt:formatDate </span><span class="na">value=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewVo</span><span class="o">.</span><span class="na">review_regdate</span> <span class="si">}</span><span class="s">"</span><span class="na"> type=</span><span class="s">"date"</span> <span class="nt">/&gt;</span>
                                <span class="nt">&lt;/td&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">id=</span><span class="s">"reviewReadcnt${it.index }"</span><span class="nt">&gt;</span>${reviewVo.review_readcnt }<span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        <span class="nt">&lt;/tbody&gt;</span>
                    <span class="nt">&lt;/table&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"reviewContent"</span> <span class="na">id=</span><span class="s">"reviewContentBox${it.index }"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;strong&gt;</span>${vo.prod_name }<span class="nt">&lt;/strong&gt;</span>
                        <span class="nt">&lt;p&gt;</span>
                            평점 : <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"reviewRating${it.index }"</span><span class="nt">&gt;</span>${reviewVo.review_rating } / 5.0<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewVo</span><span class="o">.</span><span class="na">review_image</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nl">fn:</span><span class="n">length</span><span class="o">(</span><span class="n">reviewVo</span><span class="o">.</span><span class="na">review_image</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="nt">&lt;spring:url </span><span class="na">value=</span><span class="s">"/resources/upload/images/board/review/${reviewVo.review_image }"</span><span class="nt">&gt;&lt;/spring:url&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"reviewContent${it.index }"</span><span class="nt">&gt;</span>${reviewVo.review_content }<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">sessionScope</span><span class="o">.</span><span class="na">saveID</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">user_num</span> <span class="o">==</span> <span class="n">reviewVo</span><span class="o">.</span><span class="na">user_num</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-right"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/product/modify_review?review_num=${reviewVo.review_num }"</span><span class="nt">&gt;</span>수정<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> 
                                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:void(0)"</span>
                                    <span class="na">onclick=</span><span class="s">"confirmToRemove('review', ${reviewVo.review_num}, ${vo.prod_num })"</span>
                                    <span class="na">style=</span><span class="s">"color: #5179a5;"</span><span class="nt">&gt;</span>삭제<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/c:forEach&gt;</span>
            <span class="nt">&lt;/c:otherwise&gt;</span>
        <span class="nt">&lt;/c:choose&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12 reviewBtnArea"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span> <span class="na">id=</span><span class="s">"pagediv"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${page }"</span> <span class="na">id=</span><span class="s">"curReviewPage"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12 text-center"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">prev</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/product/review_list?page=${reviewPm.startPage - 1 }"</span>
                            <span class="na">class=</span><span class="s">"arrow_carrot-left_alt pagingBtn"</span> <span class="na">id=</span><span class="s">"prev"</span><span class="nt">&gt;&lt;/a&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;c:forEach </span><span class="na">var=</span><span class="s">"block"</span><span class="na"> varStatus=</span><span class="s">"it"</span><span class="na">
                        begin=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">startPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> end=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">endPage</span> <span class="si">}</span><span class="s">"</span><span class="na"> step=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span&gt;</span> <span class="c">&lt;!----&gt;</span> 
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:void(0)"</span>
                            <span class="na">class=</span><span class="s">"pagingBtn"</span> <span class="na">id=</span><span class="s">"reviewPage${it.index }"</span> <span class="na">style=</span><span class="s">"color: black;"</span>
                            <span class="na">onclick=</span><span class="s">"changePageNum(${it.index }, ${reviewPm.endPage - reviewPm.startPage + 1 }, 'review');"</span><span class="nt">&gt;</span>${block }<span class="c">&lt;!----&gt;</span><span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                    <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">reviewPm</span><span class="o">.</span><span class="na">next</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/product/review_list?page=${reviewPm.endPage + 1 }"</span>
                            <span class="na">class=</span><span class="s">"arrow_carrot-right_alt pagingBtn"</span> <span class="na">id=</span><span class="s">"next"</span><span class="nt">&gt;&lt;/a&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;c:if </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">sessionScope</span><span class="o">.</span><span class="na">saveID</span> <span class="o">!=</span> <span class="kc">null</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"site-btn"</span>
                    <span class="na">onclick=</span><span class="s">"location.href='/product/write_review?prod_num='+${vo.prod_num};"</span><span class="nt">&gt;</span>
                    후기쓰기<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<ul>
  <li>상품 상세 페이지에서 게시판을 출력하는 부분만 임시 페이지에 복제해 놓는다. 새 데이터를 가져올 때 이 페이지를 새로고침 해서 게시판 목록을 갱신할 것이다.</li>
</ul>

<h2 id="productcontrollerjava">ProductController.java</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Ajax</code>를 사용하지만 컨트롤러는 <code class="language-plaintext highlighter-rouge">Rest</code> 컨트롤러가 아니라 일반 컨트롤러를 사용한다. 왜냐하면 새 데이터를 뷰 페이지로 전달해서 해당 뷰 페이지가 갱신되도록 해야 하기 때문이다. 위 두 글에서 이 부분에 대한 언급이 없어서 구현하는데 좀 헤멨었다.(처음에 배울 때 <code class="language-plaintext highlighter-rouge">Ajax</code>는 <code class="language-plaintext highlighter-rouge">@RestController</code>랑 같이 쓰라고 배워서 더 헤멨던 것도 있다🥲)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/product/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="nc">ProductService</span> <span class="n">service</span><span class="o">;</span>
	
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/list_review"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getReviewListGET</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"prod_num"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">prod_num</span><span class="o">,</span> 
            <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"page"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">page</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">ProdCriteria</span> <span class="n">pc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProdCriteria</span><span class="o">();</span>
        <span class="n">pc</span><span class="o">.</span><span class="na">setPage</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
        <span class="n">pc</span><span class="o">.</span><span class="na">setPerPageNum</span><span class="o">(</span><span class="mi">7</span><span class="o">);</span>
        <span class="n">pc</span><span class="o">.</span><span class="na">setProd_num</span><span class="o">(</span><span class="n">prod_num</span><span class="o">);</span>
		
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BoardReviewVO</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getReviewList</span><span class="o">(</span><span class="n">pc</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">setUser_id</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getUserid</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getUser_num</span><span class="o">()));</span>
        <span class="o">}</span>
		
        <span class="nc">ProdPageMaker</span> <span class="n">reviewPm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProdPageMaker</span><span class="o">();</span>
        <span class="n">reviewPm</span><span class="o">.</span><span class="na">setCri</span><span class="o">(</span><span class="n">pc</span><span class="o">);</span>
        <span class="n">reviewPm</span><span class="o">.</span><span class="na">setTotalCnt</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getReviewCnt</span><span class="o">(</span><span class="n">prod_num</span><span class="o">));</span>
		
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"reviewList"</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"reviewPm"</span><span class="o">,</span> <span class="n">reviewPm</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"page"</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
		
        <span class="k">return</span> <span class="s">"product/revBoardAjax"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>새 게시글 목록을 불러오고 나면 데이터를 임시 게시판 페이지로 전달해서 데이터가 갱신되게 한다. 그리고 <code class="language-plaintext highlighter-rouge">Ajax</code> 호출이기 때문에 페이지 이동은 하지 않고 메서드가 종료되면 아까 있던 곳으로 되돌아 올 것이다.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/product/list_review?prod_num=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prod_num</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&amp;page=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">결과: </span><span class="dl">'</span><span class="o">+</span><span class="nx">data</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#reviewListAjax</span><span class="dl">'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        
        <span class="c1">// 선택된 페이지 번호 css로 강조 처리</span>
        <span class="nx">getPageNum</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">통신 실패</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li>되돌아오면 임시 페이지는 새 데이터로 갱신된 상태이기 때문에 불러와서 원본 페이지에 덮어씌우기만 하면 된다. <code class="language-plaintext highlighter-rouge">append</code>로 붙이는 코드보다 훨씬 간결해서 좋다.<br /><br /><br /></li>
</ul>

<h1 id="구현하며-했던-고민">구현하며 했던 고민</h1>
<ul>
  <li>무엇보다도 어떻게 하면 <code class="language-plaintext highlighter-rouge">append</code>를 쓰지 않을 수 있는지, 그리고 <code class="language-plaintext highlighter-rouge">Ajax</code>와 일반 컨트롤러 간의 통신 흐름을 이해하는 것이었다. 왜냐면 처음엔 <code class="language-plaintext highlighter-rouge">Ajax</code>와 일반 <code class="language-plaintext highlighter-rouge">@Controller</code>의 통신 방식에 대한 정확한 이해가 되어 있지 않았기 때문에… <code class="language-plaintext highlighter-rouge">@RestController</code>에서 다른 뷰 페이지에 <code class="language-plaintext highlighter-rouge">model</code> 객체를 전달하려고 시도하는 등 시행착오가 많았다.(당연히 동작 안 됨)</li>
  <li>이번 기능을 구현하면서 <code class="language-plaintext highlighter-rouge">@Controller</code>와 <code class="language-plaintext highlighter-rouge">@RestController</code>의 차이를 확실하게 알게 되었다. 뭔가 스프링에 한 발 더 다가선 느낌~~!!<br /><br /><br /></li>
</ul>

<h1 id="마감까지">마감까지</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">D-5</code><br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://backstreet-programmer.tistory.com/105">[Web] ajax으로 받아온 data를 jstl로 표현하기</a></li>
  <li><a href="https://velog.io/@hwarkhada/ajax%EB%A1%9C-%EB%B0%9B%EC%95%84%EC%98%A8-data-%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%83%88%EB%A1%9C%EA%B3%A0%EC%B9%A8-%EC%97%86%EC%9D%B4-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0">ajax로 받아온 data 페이지 새로고침 없이 사용하기</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="Uno mas" /><category term="Project" /><category term="UnoMas" /><category term="Log" /><summary type="html"><![CDATA[작성일 : 2022.05.22 작성자 : 황유진]]></summary></entry><entry><title type="html">JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 16 - Ajax로 이미지파일 업로드</title><link href="http://localhost:4000/uno%20mas/uno-mas-dev-log-16/" rel="alternate" type="text/html" title="JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 16 - Ajax로 이미지파일 업로드" /><published>2022-05-18T00:00:00+09:00</published><updated>2022-05-18T00:00:00+09:00</updated><id>http://localhost:4000/uno%20mas/uno-mas-dev-log-16</id><content type="html" xml:base="http://localhost:4000/uno%20mas/uno-mas-dev-log-16/"><![CDATA[<ul>
  <li>작성일 : 2022.05.18</li>
  <li>
    <p>작성자 : 황유진</p>
  </li>
  <li>팀원 : 김진영, 박승지, 반현빈, 오성은, 오은현, 황유진</li>
  <li>팀장 : 황유진</li>
  <li>부팀장 : 오성은</li>
  <li>GitHub Repository : <a href="https://github.com/miro7923/Uno-Mas">https://github.com/miro7923/Uno-Mas</a><br /><br /><br /></li>
</ul>

<h1 id="개발환경">개발환경</h1>
<ul>
  <li>MacBook Air (M1, 2020)</li>
  <li>OpenJDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>Spring framework 4.3.1.RELEASE</li>
  <li>Tomcat 8.5</li>
  <li>MySQL Workbench 8.0.19<br /><br /><br /></li>
</ul>

<h1 id="기간">기간</h1>
<ul>
  <li>2022.4.13 ~ 2022.5.27<br /><br /><br /></li>
</ul>

<h1 id="주제">주제</h1>
<ul>
  <li>웹 백엔드 수업 중 마지막 과제로 팀 프로젝트를 진행하게 되었다.</li>
  <li>조건은 <code class="language-plaintext highlighter-rouge">Spring</code> 기반으로 웹 사이트를 제작하는 것이다.</li>
  <li>총 팀원은 6명이며, 우리 팀은 <code class="language-plaintext highlighter-rouge">1인 가구를 위한 쇼핑몰</code>을 주제로 정했다.</li>
  <li>팀 이름으로 정해진 <code class="language-plaintext highlighter-rouge">Uno más</code>는 스페인어로 <code class="language-plaintext highlighter-rouge">하나 더</code>라는 뜻이다. <br /><br /><br /></li>
</ul>

<h1 id="진행상황">진행상황</h1>

<p align="center"><img src="../../assets/images/unomas_uploadProdImg2.png" width="900" /></p>

<ul>
  <li>관리자용 상품 등록 페이지에서 비동기 방식으로 상품 이미지를 업로드하고 등록된 이미지를 미리볼 수 있는 기능을 구현했다.</li>
</ul>

<h2 id="productmapperxml">productMapper.xml</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"setProduct"</span><span class="nt">&gt;</span>
    INSERT INTO products(prod_name, prod_category, prod_price, prod_stock, prod_expire, 
                    prod_keep, prod_weight, prod_country, prod_sellunit, prod_explain, prod_packing, 
                    prod_discntrate, prod_image1, prod_image2, prod_image3, prod_image4)
    VALUES (#{prod_name}, #{prod_category}, #{prod_price}, #{prod_stock}, #{prod_expire}, 
            #{prod_keep}, #{prod_weight}, #{prod_country}, #{prod_sellunit}, #{prod_explain}, #{prod_packing},
            #{prod_discntrate}, #{prod_image1}, #{prod_image2}, #{prod_image3}, #{prod_image4})
<span class="nt">&lt;/insert&gt;</span>
</code></pre></div></div>

<ul>
  <li>이미지 파일을 비동기 방식으로 업로드 하기 때문에 <code class="language-plaintext highlighter-rouge">DB</code>에는 파일명만 넣어주면 된다.</li>
</ul>

<h2 id="servlet-contextxml">servlet-context.xml</h2>

<p align="center"><img src="../../assets/images/unomas_uploadProdImg3.png" width="700" /></p>

<ul>
  <li>저장되는 이미지의 종류별로 폴더를 분리하는 것이 깔끔하고 화면에 뿌려주기 위해 해당 파일을 찾아올 때 분류된 폴더에서 찾아오는 것이 더 빠를 것이라 생각해서 위와 같이 이미지가 업로드 되는 경로를 분리해 주었다.</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 상품 상세이미지 업로드 경로 --&gt;</span>
<span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"prodDimgUploadPath"</span> <span class="na">class=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;beans:constructor-arg</span> <span class="na">value=</span><span class="s">"프로젝트경로/src/main/webapp/resources/upload/images/products/detail"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans:bean&gt;</span>
    
<span class="c">&lt;!-- 상품 썸네일 업로드 경로 --&gt;</span>
<span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"prodThumbUploadPath"</span> <span class="na">class=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;beans:constructor-arg</span> <span class="na">value=</span><span class="s">"프로젝트경로/src/main/webapp/resources/upload/images/products/thumbnail"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans:bean&gt;</span>
    
<span class="c">&lt;!-- 상품 상단 이미지 업로드 경로 --&gt;</span>
<span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"prodTopImgUploadPath"</span> <span class="na">class=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;beans:constructor-arg</span> <span class="na">value=</span><span class="s">"프로젝트경로/src/main/webapp/resources/upload/images/products/top"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans:bean&gt;</span>
    
<span class="c">&lt;!-- 상품 품절 이미지 업로드 경로 --&gt;</span>
<span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"prodSoldoutImgUploadPath"</span> <span class="na">class=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;beans:constructor-arg</span> <span class="na">value=</span><span class="s">"프로젝트경로/src/main/webapp/resources/upload/images/products/soldout"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans:bean&gt;</span>
</code></pre></div></div>

<ul>
  <li>프레임워크에게 알려주기 위해 <code class="language-plaintext highlighter-rouge">servlet-context.xml</code> 파일에서 각 폴더별로 업로드 경로를 지정해 주었다.</li>
</ul>

<h2 id="productregisterjsp">productRegister.jsp</h2>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-sm-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h5&gt;</span>기본 이미지(세로)<span class="nt">&lt;/h5&gt;&lt;br&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-pic"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">alt=</span><span class="s">""</span> <span class="na">id=</span><span class="s">"prevImg1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sale pp-sale"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"prod_image1"</span> <span class="na">name=</span><span class="s">"prod_image1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"uploadImg1"</span> <span class="na">name=</span><span class="s">"uploadImg1"</span> <span class="na">oninput=</span><span class="s">"checkFileName(1, 'top');"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"catagory-name"</span><span class="nt">&gt;</span>[이미지 삭제]<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-sm-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h5&gt;</span>상품 상세 설명<span class="nt">&lt;/h5&gt;&lt;br&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-pic"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">alt=</span><span class="s">""</span> <span class="na">id=</span><span class="s">"prevImg2"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sale pp-sale"</span><span class="nt">&gt;</span>2<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"prod_image2"</span> <span class="na">name=</span><span class="s">"prod_image2"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"uploadImg2"</span> <span class="na">name=</span><span class="s">"uploadImg2"</span> <span class="na">oninput=</span><span class="s">"checkFileName(2, 'detail');"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"catagory-name"</span><span class="nt">&gt;</span>[이미지 삭제]<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-sm-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h5&gt;</span>썸네일<span class="nt">&lt;/h5&gt;&lt;br&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-pic"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">alt=</span><span class="s">""</span> <span class="na">id=</span><span class="s">"prevImg3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sale pp-sale"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"prod_image3"</span> <span class="na">name=</span><span class="s">"prod_image3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"uploadImg3"</span> <span class="na">name=</span><span class="s">"uploadImg3"</span> <span class="na">oninput=</span><span class="s">"checkFileName(3, 'thumb');"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"catagory-name"</span><span class="nt">&gt;</span>[이미지 삭제]<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 col-sm-6"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h5&gt;</span>품절 시 대체 썸네일<span class="nt">&lt;/h5&gt;&lt;br&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pi-pic"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">""</span> <span class="na">alt=</span><span class="s">""</span> <span class="na">id=</span><span class="s">"prevImg4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sale pp-sale"</span><span class="nt">&gt;</span>4<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"prod_image4"</span> <span class="na">name=</span><span class="s">"prod_image4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"uploadImg4"</span> <span class="na">name=</span><span class="s">"uploadImg4"</span> <span class="na">oninput=</span><span class="s">"checkFileName(4, 'soldout');"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"catagory-name"</span><span class="nt">&gt;</span>[이미지 삭제]<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Ajax</code>를 이용해 비동기 방식으로 이미지를 등록할 것이기 때문에 뷰 페이지에서는 <code class="language-plaintext highlighter-rouge">oninput</code> 속성에 이미지 업로드 메서드를 연결했다.</li>
  <li>이때 각 인풋 태그들에 들어갈 이미지의 종류만 다르지 수행할 동작 자체는 모두 같기 때문에 하나의 메서드에서 좀 더 쉽게 처리할 수 있도록 같은 <code class="language-plaintext highlighter-rouge">id</code>를 사용하되, <code class="language-plaintext highlighter-rouge">id="uploadImg1"</code>, <code class="language-plaintext highlighter-rouge">id="uploadImg2"</code>과 같이 맨 뒤에 번호를 부여해서 각 태그를 구분했다. 그리고 <code class="language-plaintext highlighter-rouge">oninput</code>의 <code class="language-plaintext highlighter-rouge">checkFileName(num, type)</code> 메서드에 인자값으로 해당 <code class="language-plaintext highlighter-rouge">id</code>의 번호와 이미지 타입을 넣어준다.</li>
</ul>

<h2 id="productadminjs">productAdmin.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">checkFileName</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="dl">"</span><span class="s2">(.*?)</span><span class="se">\</span><span class="s2">.(jpg|jpeg|png|gif)</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">maxSize</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>
	
    <span class="c1">// id 맨 뒤에 붙는 번호만 바꿔주면 간편하게 해당 인풋 태그를 찾아갈 수 있다.</span>
    <span class="kd">var</span> <span class="nx">fileSize</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">size</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fileSize</span> <span class="o">&gt;</span> <span class="nx">maxSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">5MB 이하만 첨부 가능합니다.</span><span class="dl">'</span><span class="p">);</span>
        <span class="c1">// 인풋 태그에 등록된 파일을 삭제한다.</span>
        <span class="nx">crossBrowsing</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
	
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">()))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">확장자가 jpeg, jpg, png, gif인 이미지 파일만 등록 가능합니다.</span><span class="dl">'</span><span class="p">);</span>
        <span class="c1">// 인풋 태그에 등록된 파일을 삭제한다.</span>
        <span class="nx">crossBrowsing</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
	
    <span class="c1">// 위에서 확장자 검사와 파일 크기 검사를 통과했을 때에만 업로드 메서드 실행 </span>
    <span class="nx">uploadImg</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 인풋 태그에 등록된 파일을 삭제하는 메서드</span>
<span class="kd">function</span> <span class="nx">crossBrowsing</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">agent</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
	
    <span class="c1">// 크로스 브라우징 처리</span>
    <span class="c1">// IE일 때</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">appName</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">Netscape</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">Trident</span><span class="dl">'</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span>
        <span class="nx">agent</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">"</span><span class="s2">msie</span><span class="dl">"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">).</span><span class="nx">clone</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
    <span class="k">else</span> <span class="c1">// 그 외 브라우저</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>	
<span class="p">}</span>

<span class="c1">// 파일 업로드를 수행하는 메서드</span>
<span class="kd">function</span> <span class="nx">uploadImg</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
	
    <span class="c1">// 업로드 할 파일을 읽어와서 이미지 미리보기 영역에 뿌려준다.</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#prevImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
	
    <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	
    <span class="c1">// 파일을 form 데이터에 담아 전송할 준비 </span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#uploadImg</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">num</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	
    <span class="c1">// 업로드 되는 이미지 타입에 따라 매핑되는 url을 다르게 설정한다.</span>
    <span class="kd">var</span> <span class="nx">newUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/product/upload_</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">switch</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">detail</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">newUrl</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">deImg</span><span class="dl">'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">top</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">newUrl</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">topImg</span><span class="dl">'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">thumb</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">newUrl</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">thumb</span><span class="dl">'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">soldout</span><span class="dl">'</span><span class="p">:</span>
            <span class="nx">newUrl</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">soldoutImg</span><span class="dl">'</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
	
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">newUrl</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">form</span><span class="p">,</span>
        <span class="na">processData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">contentType</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">이미지 업로드 성공</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">서버 오류로 지연되고 있습니다. 잠시 후 다시 시도해 주세요.</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>업로드 하려는 이미지 파일을 읽어와서 이미지 미리보기 영역에 출력한 뒤 파일 업로드를 위해 서버와 통신한 뒤 성공 유무에 따라 알림창을 출력할 것이다.</li>
</ul>

<h2 id="productajaxcontrollerjava">ProductAjaxController.java</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Ajax</code> 통신을 위한 <code class="language-plaintext highlighter-rouge">RestController</code>에서 이미지 업로드를 수행한다.</li>
  <li>이때 상품 상세페이지의 상단과 본문 영역에 보여질 이미지는 그대로 업로드 하지만 썸네일은 크기를 줄여서 업로드 할 것이라서 이미지 업로드는 두 가지 분기로 나눠진다.</li>
</ul>

<h3 id="이미지-원본-업로드">이미지 원본 업로드</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/product/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductAjaxController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="nc">ProductService</span> <span class="n">service</span><span class="o">;</span>
	
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ProductAjaxController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"reviewImgUploadPath"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">reviewImgUploatPath</span><span class="o">;</span>
	
    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"prodDimgUploadPath"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prodDimgUploadPath</span><span class="o">;</span>
	
    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"prodThumbUploadPath"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prodThumbUploadPath</span><span class="o">;</span>
	
    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"prodTopImgUploadPath"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prodTopImgUploadPath</span><span class="o">;</span>
	
    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"prodSoldoutImgUploadPath"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prodSoldoutImgUploadPath</span><span class="o">;</span>
	
    <span class="c1">// 상세페이지 상단 이미지 </span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/upload_topImg"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadTopImgPOST</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"uploadImg1"</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// 이미지 파일명 변환</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="nc">Commons</span><span class="o">.</span><span class="na">convertImgName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">service</span><span class="o">.</span><span class="na">getLastProdNum</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">ImgType</span><span class="o">.</span><span class="na">TOP</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">targetFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">prodTopImgUploadPath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="nc">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">targetFile</span><span class="o">);</span>
        <span class="o">}</span>
		
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 상세페이지 본문 이미지 </span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/upload_deImg"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadDeImgPOST</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"uploadImg2"</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="nc">Commons</span><span class="o">.</span><span class="na">convertImgName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">service</span><span class="o">.</span><span class="na">getLastProdNum</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">ImgType</span><span class="o">.</span><span class="na">DETAIL</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">targetFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">prodDimgUploadPath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="nc">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">targetFile</span><span class="o">);</span>
        <span class="o">}</span>
		
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>이미지 원본은 별도의 작업을 할 필요가 없기 때문에 지정된 경로에 그대로 업로드 한다.</li>
  <li>파일을 업로드 할 때 파일명을 각 용도별로 지정해서 사용하기로 했다. 예를 들면 상세 이미지는 <code class="language-plaintext highlighter-rouge">detail_상품번호.png</code>, 썸네일은 <code class="language-plaintext highlighter-rouge">thumbnail_상품번호.png</code>, 후기글의 이미지는 <code class="language-plaintext highlighter-rouge">review_리뷰글번호.png</code>와 같은 형태이다. 그래서 업로드되는 파일명을 변환해주는 메서드가 필요해서 따로 만들었다.</li>
  <li>파일명을 변환하는 메서드는 <code class="language-plaintext highlighter-rouge">ProductAjaxController</code> 뿐만 아니라 <code class="language-plaintext highlighter-rouge">ProductController</code>에서도 쓰이기 때문에 여러 클래스에서 공통으로 사용되는 메서드들을 모아놓은 <code class="language-plaintext highlighter-rouge">Commons</code> 클래스를 만들어서 작성했다. <code class="language-plaintext highlighter-rouge">Commons</code> 클래스의 메서드는 객체 생성 없이 바로 접근해서 사용하고 싶었기 때문에 <code class="language-plaintext highlighter-rouge">static</code> 메서드로 선언했다.</li>
</ul>

<h3 id="commonsjava">Commons.java</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 여러 컨트롤러에서 공통으로 쓸 수 있는 메서드를 모아놓은 클래스</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Commons</span> <span class="o">{</span>

    <span class="c1">// 이미지 용도에 따라 파일명 다르게 설정</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">convertImgName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num</span><span class="o">,</span> <span class="nc">ImgType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 확장자명 시작 위치 찾기</span>
        <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		
        <span class="k">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nl">DETAIL:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s">"detail_"</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">THUMBNAIL:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s">"thumbnail_"</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">TOP:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s">"top_"</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">SOLDOUT:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s">"soldout_"</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">REVIEW:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s">"review_"</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
		
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>이미지 파일명 변환 메서드에서는 이미지 타입별로 파일명을 다르게 설정할 것인데 역시 재사용성을 높이기 위해 <code class="language-plaintext highlighter-rouge">enum</code> 클래스를 사용했으며, 가독성과 속도 향상을 위해 <code class="language-plaintext highlighter-rouge">swith</code>문으로 이미지 타입을 구분하도록 했다.</li>
</ul>

<h3 id="imgtypejava">ImgType.java</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.april.unomas.domain</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ImgType</span> <span class="o">{</span>

    <span class="no">DETAIL</span><span class="o">,</span> <span class="no">THUMBNAIL</span><span class="o">,</span> <span class="no">TOP</span><span class="o">,</span> <span class="no">SOLDOUT</span><span class="o">,</span> <span class="no">REVIEW</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ImgType enum</code> 역시 여러 클래스에서 공통으로 사용되기 때문에 <code class="language-plaintext highlighter-rouge">enum</code> 클래스를 생성했다.</li>
</ul>

<h3 id="이미지-크기-줄여서-업로드">이미지 크기 줄여서 업로드</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 썸네일 업로드</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/upload_thumb"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadThumbPOST</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"uploadImg3"</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// 파일명 변환 후</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="nc">Commons</span><span class="o">.</span><span class="na">convertImgName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">service</span><span class="o">.</span><span class="na">getLastProdNum</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">ImgType</span><span class="o">.</span><span class="na">THUMBNAIL</span><span class="o">);</span>
        <span class="c1">// 이미지 크기 리사이즈</span>
        <span class="nc">Commons</span><span class="o">.</span><span class="na">resizeImg</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">prodThumbUploadPath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>
		
    <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// 품절시 대체 썸네일 업로드</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/upload_soldoutImg"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadSoldoutImgPOST</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"uploadImg4"</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="nc">Commons</span><span class="o">.</span><span class="na">convertImgName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">service</span><span class="o">.</span><span class="na">getLastProdNum</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">ImgType</span><span class="o">.</span><span class="na">SOLDOUT</span><span class="o">);</span>
        <span class="nc">Commons</span><span class="o">.</span><span class="na">resizeImg</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">prodSoldoutImgUploadPath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>
		
    <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>썸네일과 품절시 대체 썸네일은 크기가 줄여져야 한다. 이미지 크기를 조절하는 메서드 또한 <code class="language-plaintext highlighter-rouge">Commons</code> 클래스에 작성했다.</li>
</ul>

<h3 id="commonsjava-1">Commons.java</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">resizeImg</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">,</span> <span class="nc">String</span> <span class="n">filePath</span><span class="o">,</span> <span class="nc">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">// 이미지 읽어오기</span>
    <span class="nc">BufferedImage</span> <span class="n">inputImg</span> <span class="o">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
		
    <span class="c1">// 이미지 가로세로 길이 측정</span>
    <span class="kt">int</span> <span class="n">originWidth</span> <span class="o">=</span> <span class="n">inputImg</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">originHeight</span> <span class="o">=</span> <span class="n">inputImg</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
		
    <span class="c1">// 변경할 가로 길이</span>
    <span class="kt">int</span> <span class="n">newWidth</span> <span class="o">=</span> <span class="mi">360</span><span class="o">;</span>
		
    <span class="k">if</span> <span class="o">(</span><span class="n">originWidth</span> <span class="o">&gt;</span> <span class="n">newWidth</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 기존 이미지 비율을 유지하여 세로길이 설정</span>
        <span class="kt">int</span> <span class="n">newHeight</span> <span class="o">=</span> <span class="o">(</span><span class="n">originHeight</span> <span class="o">*</span> <span class="n">newWidth</span><span class="o">)</span> <span class="o">/</span> <span class="n">originWidth</span><span class="o">;</span>
			
        <span class="c1">// 이미지 품질 설정         </span>
        <span class="c1">// Image.SCALE_DEFAULT : 기본 이미지 스케일링 알고리즘 사용</span>
        <span class="c1">// Image.SCALE_FAST : 이미지 부드러움보다 속도 우선</span>
        <span class="c1">// Image.SCALE_REPLICATE : ReplicateScaleFilter 클래스로 구체화 된 이미지 크기 조절 알고리즘</span>
        <span class="c1">// Image.SCALE_SMOOTH : 속도보다 이미지 부드러움을 우선</span>
        <span class="c1">// Image.SCALE_AREA_AVERAGING : 평균 알고리즘 사용</span>
        <span class="nc">Image</span> <span class="n">resizeImg</span> <span class="o">=</span> <span class="n">inputImg</span><span class="o">.</span><span class="na">getScaledInstance</span><span class="o">(</span><span class="n">newWidth</span><span class="o">,</span> <span class="n">newHeight</span><span class="o">,</span> <span class="nc">Image</span><span class="o">.</span><span class="na">SCALE_FAST</span><span class="o">);</span>
        <span class="nc">BufferedImage</span> <span class="n">newImg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedImage</span><span class="o">(</span><span class="n">newWidth</span><span class="o">,</span> <span class="n">newHeight</span><span class="o">,</span> <span class="nc">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
        <span class="nc">Graphics</span> <span class="n">graphics</span> <span class="o">=</span> <span class="n">newImg</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span>
        <span class="n">graphics</span><span class="o">.</span><span class="na">drawImage</span><span class="o">(</span><span class="n">resizeImg</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">graphics</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
			
        <span class="c1">// 이미지 저장</span>
        <span class="nc">File</span> <span class="n">newFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
        <span class="nc">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">newImg</span><span class="o">,</span> <span class="n">fileName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">newFile</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// 이미지 저장</span>
        <span class="nc">File</span> <span class="n">newFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">filePath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
        <span class="nc">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">newFile</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>업로드 된 파일과 업로드 될 경로, 변환된 파일명을 인자값으로 받아와 이미지 크기 조절 후 업로드를 수행한다.</li>
  <li>이미지 크기 조절은 지정된 썸네일 크기보다 클 때 수행한다.<br /><br /><br /></li>
</ul>

<h1 id="구현하며-했던-고민">구현하며 했던 고민</h1>
<ul>
  <li>업로드 한 이미지를 실시간으로 미리볼 수 있게 하는 기능을 구현하는 것이 가장 고민이었다. 왜냐면 처음 해 보는 것이었고 학원에서 배웠던 것은 동기방식으로 미리보기 없이 업로드 하는 방식이었기 때문이다.</li>
  <li>
    <p>하지만 이와 관련해서 구글에 레퍼런스가 많았기 때문에 약 세 시간 정도 걸려서 구현할 수 있었다.</p>
  </li>
  <li>그리고 파일명을 변환하는 메서드와 같이 여러 클래스에서 공통적으로 쓰이게 되는 메서드의 중복 작성을 줄이고자 <code class="language-plaintext highlighter-rouge">Commons</code> 클래스와 <code class="language-plaintext highlighter-rouge">static</code> 메서드를 만드는 과정에서 자바의 <code class="language-plaintext highlighter-rouge">static</code> 메서드 선언 규칙을 다시 공부할 수 있어서 좋았다. 왜냐면 <code class="language-plaintext highlighter-rouge">static</code> 메서드 사용 관련해서는 <code class="language-plaintext highlighter-rouge">C++</code> 기준 지식을 가지고 있었기 때문에…ㅎ<br /><br /><br /></li>
</ul>

<h1 id="마감까지">마감까지</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">D-9</code><br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://cloud0477.tistory.com/122">ajax으로 file upload를 해보자 &amp; 첨부파일 이미지 미리보기</a></li>
  <li><a href="https://gorokke.tistory.com/214">JAVA 이미지 리사이징, 가로세로 크기 줄이기</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="Uno mas" /><category term="Project" /><category term="UnoMas" /><category term="Log" /><summary type="html"><![CDATA[작성일 : 2022.05.18 작성자 : 황유진]]></summary></entry><entry><title type="html">JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 15 - 후기글 첨부 이미지의 수정과 삭제</title><link href="http://localhost:4000/uno%20mas/uno-mas-dev-log-15/" rel="alternate" type="text/html" title="JAVA Spring) 1인가구를 위한 쇼핑몰 Uno más 개발일지 15 - 후기글 첨부 이미지의 수정과 삭제" /><published>2022-05-17T00:00:00+09:00</published><updated>2022-05-17T00:00:00+09:00</updated><id>http://localhost:4000/uno%20mas/uno-mas-dev-log-15</id><content type="html" xml:base="http://localhost:4000/uno%20mas/uno-mas-dev-log-15/"><![CDATA[<ul>
  <li>작성일 : 2022.05.17</li>
  <li>
    <p>작성자 : 황유진</p>
  </li>
  <li>팀원 : 김진영, 박승지, 반현빈, 오성은, 오은현, 황유진</li>
  <li>팀장 : 황유진</li>
  <li>부팀장 : 오성은</li>
  <li>GitHub Repository : <a href="https://github.com/miro7923/Uno-Mas">https://github.com/miro7923/Uno-Mas</a><br /><br /><br /></li>
</ul>

<h1 id="개발환경">개발환경</h1>
<ul>
  <li>MacBook Air (M1, 2020)</li>
  <li>OpenJDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>Spring framework 4.3.1.RELEASE</li>
  <li>Tomcat 8.5</li>
  <li>MySQL Workbench 8.0.19<br /><br /><br /></li>
</ul>

<h1 id="기간">기간</h1>
<ul>
  <li>2022.4.13 ~ 2022.5.27<br /><br /><br /></li>
</ul>

<h1 id="주제">주제</h1>
<ul>
  <li>웹 백엔드 수업 중 마지막 과제로 팀 프로젝트를 진행하게 되었다.</li>
  <li>조건은 <code class="language-plaintext highlighter-rouge">Spring</code> 기반으로 웹 사이트를 제작하는 것이다.</li>
  <li>총 팀원은 6명이며, 우리 팀은 <code class="language-plaintext highlighter-rouge">1인 가구를 위한 쇼핑몰</code>을 주제로 정했다.</li>
  <li>팀 이름으로 정해진 <code class="language-plaintext highlighter-rouge">Uno más</code>는 스페인어로 <code class="language-plaintext highlighter-rouge">하나 더</code>라는 뜻이다. <br /><br /><br /></li>
</ul>

<h1 id="진행상황">진행상황</h1>

<p align="center"><img src="../../assets/images/unomas_reviewImg.png" width="900" /></p>

<ul>
  <li>상품 후기글에 이미지 하나를 첨부할 수 있도록 설계했기 때문에 후기글에 등록되는 이미지의 업로드 및 수정과 삭제가 가능하게 하는 기능을 구현했다. 업로드 자체는 <code class="language-plaintext highlighter-rouge">MultipartFile</code>로 쉽게 구현할 수 있었지만 수정 기능을 구현하는 과정이 만만치 않았기 때문에 기록으로 남긴다.</li>
</ul>

<h2 id="productmapperxml">productMapper.xml</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"updateReview"</span><span class="nt">&gt;</span>
    UPDATE board_review
    SET review_title = #{review_title}, review_content = #{review_content}, review_rating = #{review_rating}, review_image = #{review_image}
    WHERE review_num = #{review_num}
<span class="nt">&lt;/update&gt;</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DB</code> 업데이트를 위한 쿼리문에서는 별도의 조건문 없이 입력받은 데이터를 그대로 사용하기 때문에 여기까지 오기 전에 후기글과 함께 업로드 되는 이미지 파일명에 대한 검증을 거친 후 추가 작업이 필요하다.</li>
</ul>

<h2 id="productcontrollerjava">ProductController.java</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/modify_review"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">modifyReviewPOST</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"review_image"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">BoardReviewVO</span> <span class="n">vo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BoardReviewVO</span><span class="o">();</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_num"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setProd_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"prod_num"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_content</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_content"</span><span class="o">));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_rating</span><span class="o">(</span><span class="nc">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_rating"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_title</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_title"</span><span class="o">));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setUser_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"user_num"</span><span class="o">)));</span>
		
    <span class="nc">String</span> <span class="n">reviewImg</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getReviewImg</span><span class="o">(</span><span class="n">vo</span><span class="o">.</span><span class="na">getReview_num</span><span class="o">());</span>
    <span class="nc">String</span> <span class="n">uploadImgName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"uploadImgName"</span><span class="o">);</span>

    <span class="c1">// 업로드 된 파일이 있을 때 </span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// 기존에 저장된 이미지가 없는 경우 파일이름 생성</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">reviewImg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">reviewImg</span> <span class="o">=</span> <span class="n">convertImgName</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">(),</span> <span class="n">vo</span><span class="o">.</span><span class="na">getReview_num</span><span class="o">());</span>
        <span class="o">}</span>
        
        <span class="c1">// 파일 새로 업로드 </span>
        <span class="nc">File</span> <span class="n">targetFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">reviewImgUploatPath</span><span class="o">,</span> <span class="n">reviewImg</span><span class="o">);</span>
        <span class="nc">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">targetFile</span><span class="o">);</span>
        <span class="n">vo</span><span class="o">.</span><span class="na">setReview_image</span><span class="o">(</span><span class="n">reviewImg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// 업로드 된 파일이 없을 때</span>
    <span class="k">else</span> <span class="o">{</span> 
        <span class="c1">// 기존에 업로드 된 파일이 없거나 글을 수정하며 이미지를 삭제한 경우</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">uploadImgName</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"이미지 선택"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">reviewImg</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 기존에 업로드 된 파일이 있으면 서버에서 삭제</span>
                <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">reviewImgUploatPath</span> <span class="o">+</span> <span class="nc">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">reviewImg</span><span class="o">);</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span>
                    <span class="n">f</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
            <span class="o">}</span>
            
            <span class="c1">// 기존 파일명 삭제</span>
            <span class="n">vo</span><span class="o">.</span><span class="na">setReview_image</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// 기존에 업로드 된 파일이 있으면 그대로 사용</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">vo</span><span class="o">.</span><span class="na">setReview_image</span><span class="o">(</span><span class="n">uploadImgName</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
		
    <span class="n">service</span><span class="o">.</span><span class="na">modifyReview</span><span class="o">(</span><span class="n">vo</span><span class="o">);</span>
		
    <span class="k">return</span> <span class="s">"redirect:/product/product_detail?prod_num="</span> <span class="o">+</span> <span class="n">vo</span><span class="o">.</span><span class="na">getProd_num</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>매퍼에 후기글에 대한 정보를 보낼 때 <code class="language-plaintext highlighter-rouge">BoardReviewVO</code>를 사용해서 보내는데 게시글을 수정할 때 이미지 파일에 대한 정보도 설정해 주지 않으면 <code class="language-plaintext highlighter-rouge">VO</code> 속의 이미지 파일명 필드는 <code class="language-plaintext highlighter-rouge">null</code>로 남아있는 상태로 매퍼에 전달될 것이다. 그렇게 되면 기존에 서버에 업로드 된 이미지파일이 있는데도 DB 데이터 상에서는 이미지 파일명 정보가 없기 때문에 화면에 출력되지 않는다. 그래서 첨부파일이 포함된 게시글을 수정할 때엔 위와 같이 분기를 나누어 처리해 주게 했다.<br /><br /><br /></li>
</ul>

<h1 id="구현하며-했던-고민">구현하며 했던 고민</h1>
<ul>
  <li>가장 고민했던 것은 사용자가 글을 수정하면서 이미지를 삭제했는지 아닌지 여부를 확인하는 것이었다. 단순히 <code class="language-plaintext highlighter-rouge">file</code>로 넘어온 정보가 있고 없고로 따질 수 없었기 때문이다. <code class="language-plaintext highlighter-rouge">file</code>타입의 인풋태그 특성상 게시글을 작성할 때 파일을 업로드 하지 않으면 사진 첨부 영역의 삭제 버튼을 눌러서 이미지를 삭제해도 값이 비어있고 기존에 업로드했던 이미지를 삭제하는 동작을 하지 않아도 값이 비어있다. 즉 게시글을 수정할 때 새로운 이미지를 첨부하지 않는다면 항상 비어있는 상태로 전송되는 것이다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;c:choose&gt;</span>
    <span class="nt">&lt;c:when </span><span class="na">test=</span><span class="s">"</span><span class="si">${</span><span class="n">vo</span><span class="o">.</span><span class="na">review_image</span> <span class="o">==</span> <span class="kc">null</span> <span class="si">}</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"uploadImgName"</span> <span class="na">id=</span><span class="s">"uploadImgName"</span> <span class="na">value=</span><span class="s">"이미지 선택"</span>
            <span class="na">readonly</span> <span class="na">name=</span><span class="s">"uploadImgName"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;/c:when&gt;</span>
    <span class="nt">&lt;c:otherwise&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"uploadImgName"</span> <span class="na">id=</span><span class="s">"uploadImgName"</span> <span class="na">value=</span><span class="s">"${vo.review_image }"</span>
            <span class="na">readonly</span> <span class="na">name=</span><span class="s">"uploadImgName"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/c:otherwise&gt;</span>
<span class="nt">&lt;/c:choose&gt;</span>
<span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"site-btn"</span> <span class="na">for=</span><span class="s">"uploadImg"</span> <span class="na">id=</span><span class="s">"uploadBtn"</span><span class="nt">&gt;</span>업로드<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"site-btn"</span> <span class="na">onclick=</span><span class="s">"removeImg();"</span><span class="nt">&gt;</span>삭제<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"uploadImg"</span> <span class="na">name=</span><span class="s">"review_image"</span> <span class="na">oninput=</span><span class="s">"checkFileName();"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<ul>
  <li>뷰 페이지 UI 디자인을 하며 업로드 하려는 파일명을 출력하는 인풋 태그를 분리해 뒀기 때문에 파일명이 출력되는 인풋 태그의 값에 따라 기존에 업로드 된 이미지 파일의 존재 유무를 확인하도록 설계했다.<br /><br /><br /></li>
</ul>

<h1 id="마감까지">마감까지</h1>
<ul>
  <li><code class="language-plaintext highlighter-rouge">D-10</code></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="Uno mas" /><category term="Project" /><category term="UnoMas" /><category term="Log" /><summary type="html"><![CDATA[작성일 : 2022.05.17 작성자 : 황유진]]></summary></entry><entry><title type="html">에러해결 Log) (Spring framework) &amp;lt; session-config &amp;gt; element is limited to 1 occurrence</title><link href="http://localhost:4000/errorlog/warning-log-11/" rel="alternate" type="text/html" title="에러해결 Log) (Spring framework) &amp;lt; session-config &amp;gt; element is limited to 1 occurrence" /><published>2022-05-17T00:00:00+09:00</published><updated>2022-05-17T00:00:00+09:00</updated><id>http://localhost:4000/errorlog/warning-log-11</id><content type="html" xml:base="http://localhost:4000/errorlog/warning-log-11/"><![CDATA[<h1 id="사용환경">사용환경</h1>
<ul>
  <li>MacBook Air (M1, 2020) 16GB</li>
  <li>JDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>tomcat 8.5<br /><br /><br /></li>
</ul>

<h1 id="에러의-발생">에러의 발생</h1>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;session-config&gt;</span> element is limited to 1 occurrence
... 이하 생략
}
</code></pre></div></div>

<ul>
  <li>팀 프로젝트 진행 중 팀원의 작업물을 <code class="language-plaintext highlighter-rouge">master</code> 브랜치에 머지하고 난 후 이런 메세지가 뜨면서 서버 실행이 되지 않는 것이었다. 풀 리퀘에서 충돌 확인 할 때도 별 문제 없었는데 무슨 일…?<br /><br /><br /></li>
</ul>

<h1 id="문제-해결">문제 해결</h1>

<p align="center"><img src="../../assets/images/sessionConfigError.png" width="500" /></p>

<ul>
  <li>문제는 <code class="language-plaintext highlighter-rouge">web.xml</code> 파일에서 세션 유지 시간을 설정하는 태그가 두 번 작성되어 있었던 것이었다… 머지시 충돌나는 부분을 처리하는 과정에서 제대로 보지 못 하고 머지를 해서 저렇게 되었던 모양이다. 동일한 태그 하나를 지워주니까 서버가 정상적으로 실행되었다.<br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://to-dy.tistory.com/89">[에러] &lt; session-config &gt; element is limited to 1 occurrence</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="ErrorLog" /><category term="Error" /><category term="Solve" /><category term="Log" /><summary type="html"><![CDATA[사용환경 MacBook Air (M1, 2020) 16GB JDK 8 Spring Tool Suite 4.14.0 tomcat 8.5]]></summary></entry><entry><title type="html">에러해결 Log) (Spring framework) 파일업로드시 MultipartFile 변수 값이 null로 입력될 때 해결방법</title><link href="http://localhost:4000/errorlog/warning-log-10/" rel="alternate" type="text/html" title="에러해결 Log) (Spring framework) 파일업로드시 MultipartFile 변수 값이 null로 입력될 때 해결방법" /><published>2022-05-16T00:00:00+09:00</published><updated>2022-05-16T00:00:00+09:00</updated><id>http://localhost:4000/errorlog/warning-log-10</id><content type="html" xml:base="http://localhost:4000/errorlog/warning-log-10/"><![CDATA[<h1 id="사용환경">사용환경</h1>
<ul>
  <li>MacBook Air (M1, 2020) 16GB</li>
  <li>JDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>tomcat 8.5<br /><br /><br /></li>
</ul>

<h1 id="에러의-발생">에러의 발생</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/write_review"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">writeReviewPOST</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">BoardReviewVO</span> <span class="n">vo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BoardReviewVO</span><span class="o">();</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setProd_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"prod_num"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_content</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_content"</span><span class="o">));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_rating</span><span class="o">(</span><span class="nc">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_rating"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_title</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"review_title"</span><span class="o">));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setUser_num</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"user_num"</span><span class="o">)));</span>
    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_ip</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">());</span>
		
    <span class="c1">// 리뷰 이미지파일명: review_리뷰글번호</span>
    <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"review_"</span> <span class="o">+</span> <span class="n">service</span><span class="o">.</span><span class="na">getLastReviewNum</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
		
    <span class="nc">File</span> <span class="n">targetFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">reviewImgUploatPath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
    <span class="nc">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">targetFile</span><span class="o">);</span>

    <span class="n">vo</span><span class="o">.</span><span class="na">setReview_image</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
		
    <span class="n">service</span><span class="o">.</span><span class="na">insertReview</span><span class="o">(</span><span class="n">vo</span><span class="o">);</span>
		
    <span class="k">return</span> <span class="s">"redirect:/product/product_detail?prod_num="</span> <span class="o">+</span> <span class="n">vo</span><span class="o">.</span><span class="na">getProd_num</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jsp</code> 파일에서 <code class="language-plaintext highlighter-rouge">enctype</code>을 <code class="language-plaintext highlighter-rouge">multipart/form-data</code>로 지정하고 컨트롤러에서 <code class="language-plaintext highlighter-rouge">MultipartFile</code>로 받게 했는데 <code class="language-plaintext highlighter-rouge">file</code> 변수의 값이 자꾸 <code class="language-plaintext highlighter-rouge">null</code>로 나오는 것이었다. 수업시간에 한대로 따라했는데 이게 뭐람<br /><br /><br /></li>
</ul>

<h1 id="문제-해결">문제 해결</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/write_review"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">writeReviewPOST</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"review_image"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// ...생략</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>위처럼 <code class="language-plaintext highlighter-rouge">MultipartFile</code> 변수가 어떤 파라미터와 연관이 있는지 지정해 주어야 했다. 파일 업로드 태그는 하나 뿐이었건만 함께 넘어오는 파라미터가 많아서 못 찾은 걸까? 어쨌든 새로운 사실도 알게 되었고 문제도 해결했다.<br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&amp;blogId=websearch&amp;logNo=221309319248">[스프링] MultipartFile 변수가 null 로 입력되는 문제 해결 방법</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="ErrorLog" /><category term="Error" /><category term="Solve" /><category term="Log" /><summary type="html"><![CDATA[사용환경 MacBook Air (M1, 2020) 16GB JDK 8 Spring Tool Suite 4.14.0 tomcat 8.5]]></summary></entry><entry><title type="html">에러해결 Log) (Spring framework) There is no getter for property named ‘prod_num’ in ‘class java.lang.Integer’</title><link href="http://localhost:4000/errorlog/warning-log-09/" rel="alternate" type="text/html" title="에러해결 Log) (Spring framework) There is no getter for property named ‘prod_num’ in ‘class java.lang.Integer’" /><published>2022-05-15T00:00:00+09:00</published><updated>2022-05-15T00:00:00+09:00</updated><id>http://localhost:4000/errorlog/warning-log-09</id><content type="html" xml:base="http://localhost:4000/errorlog/warning-log-09/"><![CDATA[<h1 id="사용환경">사용환경</h1>
<ul>
  <li>MacBook Air (M1, 2020) 16GB</li>
  <li>JDK 8</li>
  <li>Spring Tool Suite 4.14.0</li>
  <li>tomcat 8.5<br /><br /><br /></li>
</ul>

<h1 id="에러의-발생">에러의 발생</h1>

<p><code class="language-plaintext highlighter-rouge">There is no getter for property named 'prod_num' in 'class java.lang.Integer'</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">MyBatis</code> 매퍼에서 새로운 쿼리문을 만들고 컨트롤러단에서 단위 테스트를 진행했다. 그런데 암만 봐도 잘못 쓴 곳이 없는 거 같은데 자꾸 이런 에러가 나는 것이었다…<br /><br /><br /></li>
</ul>

<h1 id="문제-해결">문제 해결</h1>

<p align="center"><img src="../../assets/images/mybatisError5.png" width="600" /></p>

<ul>
  <li>그래서 DB에 접근하는 부분마다 로그를 찍어 보았다.</li>
  <li>
    <p>그리고 발견한 문제는 <code class="language-plaintext highlighter-rouge">service.getInquiryCnt(prod_num)</code>와 연결되는 <code class="language-plaintext highlighter-rouge">mapper</code>의 쿼리문에서 변수명을 넣어주는 자리에 <code class="language-plaintext highlighter-rouge">${prod_num}</code> 이딴 식으로 쓴 것이었다… 후…….🥲</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">#{prod_num}</code>으로 수정해 주니까 잘 해결 되었다.<br /><br /><br /></li>
</ul>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://velog.io/@jaewon95/%ED%95%B4%EA%B2%B0%EB%A9%94%EB%AA%A8-There-is-no-getter-for-property-named-bno-in-class-java.lang.Integer-%EC%98%A4%EB%A5%98">해결메모 There is no getter for property named ‘bno’ in ‘class java.lang.Integer’ 오류</a></li>
</ul>]]></content><author><name>Yujin Hwang</name><email>miro7923@gmail.com</email></author><category term="ErrorLog" /><category term="Error" /><category term="Solve" /><category term="Log" /><summary type="html"><![CDATA[사용환경 MacBook Air (M1, 2020) 16GB JDK 8 Spring Tool Suite 4.14.0 tomcat 8.5]]></summary></entry></feed>